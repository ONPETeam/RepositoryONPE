<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/color.css" />
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css" />
    <link href="../../css/fitem.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
    <script src="combobox_data1.js" type="text/javascript"></script>
    <script src="../../Scripts/EasyUI/easyui-lang-zh_CN.js" type="text/javascript"></script>
    <script src="combox.js" type="text/javascript"></script>
    <body>
        <input id="12" type="hidden" />
        <div id="cc" class="easyui-calendar"></div>
         <div>
             <label>开始时间:</label>
             <input id="BT" class="easyui-datebox" data-options="sharedCalendar:'#cc'" required:true />
             <label>结束时间:</label>
             <input id="ET" class="easyui-datebox" data-options="sharedCalendar:'#cc'" required:true />
             <label>本月:</label><input id="by" type="checkbox" />
             <label>上月:</label><input id="sy" type="checkbox" />
             <a href="#" class="easyui-linkbutton" iconcls="icon-search" onclick="chakan()">查询</a>
         </div>
         <div></div>
        <div>
            <label>统计数据:</label>
            <input id="ec1" class="easyui-combobox" />
            <label>工艺参数:</label>
            <input id="ec2" class="easyui-combobox" />
            <label>窑</label>
            <input id="ec3" class="easyui-combobox" />
        </div>
        <div>
            <label>统计进度:</label><div id="p" class="easyui-progressbar" style="width: 400px;"></div><label id="lb"></label>
        </div>
        <div data-options="fit:true">
            <table id="dg" title="生产总量报表"></table>
        </div>
        
    </body>
</html>
<script type="text/javascript">

    $(document).ready(function () {

        $('#ec1').combobox({
            //url: 'combobox_data1.json',
            data: abc,
            method: 'get',
            valueField: 'id',
            textField: 'text',
            groupField: 'group',
            panelHeight: 'auto',
            multiple: true,
            formatter: function (row) {
                var opts = $(this).combobox('options');
                return '<input type="checkbox" class="combobox-checkbox">' + row[opts.textField]
            },
            onLoadSuccess: function () {
                var opts = $(this).combobox('options');
                var target = this;
                var values = $(target).combobox('getValues');
                $.map(values, function (value) {
                    var el = opts.finder.getEl(target, value);
                    el.find('input.combobox-checkbox')._propAttr('checked', true);
                })
            },
            onSelect: function (row) {
                //console.log(row);
                var opts = $(this).combobox('options');
                var el = opts.finder.getEl(this, row[opts.valueField]);
                el.find('input.combobox-checkbox')._propAttr('checked', true);
                if (row.text == '总产量') {
                    $('#dg').datagrid('showColumn', 'dFltCL');
                }
                if (row.text == '原石用量') {
                    $('#dg').datagrid('showColumn', 'dFltYS');
                }
                if (row.text == '燃气消耗') {
                    $('#dg').datagrid('showColumn', 'dFltRQXH');
                }

                if (row.text == '燃气能耗') {
                    $('#dg').datagrid('showColumn', 'dFltRQNH');
                }

                if (row.text == '电量消耗') {
                    $('#dg').datagrid('showColumn', 'dFltDLXH');
                }

                if (row.text == '综合能耗') {
                    $('#dg').datagrid('showColumn', 'dFltZHNH');
                }

                if (row.text == '作业率') {
                    $('#dg').datagrid('showColumn', 'dFltZYL');
                }

                if (row.text == '石灰单位原石消耗') {
                    $('#dg').datagrid('showColumn', 'dFltDWYSXH');
                }

                if (row.text == '石灰单位电能') {
                    $('#dg').datagrid('showColumn', 'dFltDWDN');
                }

                if (row.text == '石灰单位能耗') {
                    $('#dg').datagrid('showColumn', 'dFltDWNH');
                }

                if (row.text == '石灰单位综合能耗') {
                    $('#dg').datagrid('showColumn', 'dFltDWZHNH');
                }
            },
            onUnselect: function (row) {
                var opts = $(this).combobox('options');
                var el = opts.finder.getEl(this, row[opts.valueField]);
                el.find('input.combobox-checkbox')._propAttr('checked', false);
                if (row.text == '总产量') {
                    $('#dg').datagrid('hideColumn', 'dFltCL');
                }
                if (row.text == '原石用量') {
                    $('#dg').datagrid('hideColumn', 'dFltYS');
                }
                if (row.text == '燃气消耗') {
                    $('#dg').datagrid('hideColumn', 'dFltRQXH');
                }
                if (row.text == '燃气能耗') {
                    $('#dg').datagrid('hideColumn', 'dFltRQNH');
                }

                if (row.text == '电量消耗') {
                    $('#dg').datagrid('hideColumn', 'dFltDLXH');
                }

                if (row.text == '综合能耗') {
                    $('#dg').datagrid('hideColumn', 'dFltZHNH');
                }

                if (row.text == '作业率') {
                    $('#dg').datagrid('hideColumn', 'dFltZYL');
                }

                if (row.text == '石灰单位原石消耗') {
                    $('#dg').datagrid('hideColumn', 'dFltDWYSXH');
                }

                if (row.text == '石灰单位电能') {
                    $('#dg').datagrid('hideColumn', 'dFltDWDN');
                }

                if (row.text == '石灰单位能耗') {
                    $('#dg').datagrid('hideColumn', 'dFltDWNH');
                }

                if (row.text == '石灰单位综合能耗') {
                    $('#dg').datagrid('hideColumn', 'dFltDWZHNH');
                }
            }
        });
        $('#ec2').combobox({
            //url: 'combobox_data1.json',
            data: gycs,
            method: 'get',
            valueField: 'id',
            textField: 'text',
            groupField: 'group',
            panelHeight: 'auto',
            multiple: true,
            formatter: function (row) {
                var opts = $(this).combobox('options');
                return '<input type="checkbox" class="combobox-checkbox">' + row[opts.textField]
            },
            onLoadSuccess: function () {
                var opts = $(this).combobox('options');
                var target = this;
                var values = $(target).combobox('getValues');
                $.map(values, function (value) {
                    var el = opts.finder.getEl(target, value);
                    el.find('input.combobox-checkbox')._propAttr('checked', true);
                })
            },
            onSelect: function (row) {
                //console.log(row);
                var opts = $(this).combobox('options');
                var el = opts.finder.getEl(this, row[opts.valueField]);
                el.find('input.combobox-checkbox')._propAttr('checked', true);
                if (row.text == 'TT611') {
                    $('#dg').datagrid('showColumn', 'dFltTT611');
                }
                if (row.text == 'TT612') {
                    $('#dg').datagrid('showColumn', 'dFltTT612');
                }
                if (row.text == 'TT613') {
                    $('#dg').datagrid('showColumn', 'dFltTT613');
                }
                if (row.text == 'TT614') {
                    $('#dg').datagrid('showColumn', 'dFltTT614');
                }
                if (row.text == 'TT615') {
                    $('#dg').datagrid('showColumn', 'dFltTT615');
                }
                if (row.text == 'TT616') {
                    $('#dg').datagrid('showColumn', 'dFltTT616');
                }
                if (row.text == 'TT617') {
                    $('#dg').datagrid('showColumn', 'dFltTT617');
                }
            },
            onUnselect: function (row) {
                var opts = $(this).combobox('options');
                var el = opts.finder.getEl(this, row[opts.valueField]);
                el.find('input.combobox-checkbox')._propAttr('checked', false);
                if (row.text == 'TT611') {
                    $('#dg').datagrid('hideColumn', 'dFltTT611');
                }
                if (row.text == 'TT612') {
                    $('#dg').datagrid('hideColumn', 'dFltTT612');
                }
                if (row.text == 'TT613') {
                    $('#dg').datagrid('hideColumn', 'dFltTT613');
                }
                if (row.text == 'TT614') {
                    $('#dg').datagrid('hideColumn', 'dFltTT614');
                }
                if (row.text == 'TT615') {
                    $('#dg').datagrid('hideColumn', 'dFltTT615');
                }
                if (row.text == 'TT616') {
                    $('#dg').datagrid('hideColumn', 'dFltTT616');
                }
                if (row.text == 'TT617') {
                    $('#dg').datagrid('hideColumn', 'dFltTT617');
                }
            }
        });
        $('#ec3').combobox({
            //url: 'combobox_data1.json',
            data: yao,
            method: 'get',
            valueField: 'id',
            textField: 'text',
            groupField: 'group',
            panelHeight: 'auto',
            multiple: true,
            formatter: function (row) {
                var opts = $(this).combobox('options');
                return '<input type="checkbox" class="combobox-checkbox">' + row[opts.textField]
            },
            onLoadSuccess: function () {
                var opts = $(this).combobox('options');
                var target = this;
                var values = $(target).combobox('getValues');
                $.map(values, function (value) {
                    var el = opts.finder.getEl(target, value);
                    el.find('input.combobox-checkbox')._propAttr('checked', true);
                })
            },
            onSelect: function (row) {
                //console.log(row);
                var opts = $(this).combobox('options');
                var el = opts.finder.getEl(this, row[opts.valueField]);
                el.find('input.combobox-checkbox')._propAttr('checked', true);
                $('#12').val($("#ec3").combobox('getValues'));

                $('#dg').datagrid('load', {
                    cx: $('#12').val()
                });
            },
            onUnselect: function (row) {
                var opts = $(this).combobox('options');
                var el = opts.finder.getEl(this, row[opts.valueField]);
                el.find('input.combobox-checkbox')._propAttr('checked', false);
                $('#12').val($("#ec3").combobox('getValues'));
                $('#dg').datagrid('load', {
                    cx: $('#12').val()
                });
            }
        });

        //        $('#12').val($("#ec3").combobox('getValues'));
        $('#dg').datagrid({
            url: '../../ashx/plc/ahReport.ashx?action=grid',
            method: 'post',
            //            queryParams: {
            //                cx: $('#12').val()
            //            },
            loadMsg: "数据处理中，请稍后...",
            pagination: false, //分页控件
            remoteSort: true,
            pagePosition: 'bottom', //分页控件位置
            rownumbers: true,
            singleSelect: true,
            columns: [[
                { field: 'dVchChanxianName', title: '产线', width: 60, align: 'right' },
                { field: 'dFltCL', title: '总产量', width: 100, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltYS', title: '原石用量', width: 100, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltRQXH', title: '燃气消耗', width: 100, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltRQNH', title: '燃气能耗', width: 100, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltDLXH', title: '电量消耗', width: 60, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltZHNH', title: '综合能耗', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltZYL', title: '作业率', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltDWYSXH', title: '石灰单位原石消耗', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltDWDN', title: '石灰单位电能', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltDWNH', title: '石灰单位能耗', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltDWZHNH', title: '石灰单位综合能耗', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT611', title: 'TT611', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT612', title: 'TT612', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT613', title: 'TT613', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT614', title: 'TT614', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT615', title: 'TT615', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT616', title: 'TT616', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT617', title: 'TT617', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT618', title: 'TT618', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT619', title: 'TT619', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                },
                { field: 'dFltTT620', title: 'TT620', width: 50, align: 'right', formatter: function (value, row, index) {
                    if (value < 0) {
                        return "数据不全";
                    } else {
                        return value;
                    }
                } 
                }
            //                { field: 'dVchUserName', title: '用户', width: 50, align: 'right'},
            //                { field: 'dVchRemark', title: '备注', width: 50, align: 'right' }
            ]]

            //width: 1066
            //rowStyler: function (index, row) { if (index % 2 == 0) { return 'background-color:#ccccff;'; } },
            //striped: true, pagination: true, rownumbers: true, singleSelect: true, pageNumber: 1, pageSize: 8, pageList: [1, 2, 4, 8, 16, 32], showFooter: true,
            //            toolbar: [{
            //                text: '添加',
            //                iconCls: 'icon-add',
            //                handler: function () { Add() }
            //            }, {
            //                text: '修改',
            //                iconCls: 'icon-edit',
            //                handler: function () { edit() }
            //            }, '-', {
            //                text: '删除',
            //                iconCls: 'icon-cut',
            //                handler: function () { del() }
            //            }
            //            ]
        });
        //        var p = $('#dg').datagrid('getPager');
        //        $(p).pagination({
        //            pageSize: 10, //每页显示的记录条数，默认为10 
        //            pageList: [10, 20, 30], //可以设置每页记录条数的列表 
        //            beforePageText: '第', //页数文本框前显示的汉字 
        //            afterPageText: '页    共 {pages} 页',
        //            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        //        });
        //        $('#dg').datagrid('hideColumn', 'dIntGzID')
        //        $('#dg').datagrid('hideColumn', 'dIntGongYiXitongID')
    });

    //添加、修改、删除
    var url;
    function chakan() {
        var abc = $('#BT').datebox('getValue');
        var equipInfo = {
            BeginTime: $('#BT').datebox('getValue'),
            EndTime: $('#ET').datebox('getValue')

        };
        $.ajax({
            type: 'post',
            url: '../../ashx/plc/ahReport.ashx?action=add',
            data: equipInfo,
            dataType: 'text',
            success: function (msg) {
                if (msg == "0") {
                    $('#p').progressbar('setValue', 0);
                    start();
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.msg
                    });
                }
            }
        });
    }

    function start() {

        var label = document.getElementById("lb");
        var value = $('#p').progressbar('getValue');
        if (value < 100) {
            value += 10
            $('#p').progressbar('setValue', value);
            setTimeout(arguments.callee, 500);

            label.innerText = " ...请稍等!";
            $("#lb").html("数据处理上传中...请稍等!");
        }
        else if (value = 100) {
            label.innerText = "数据上传成功...更新报表!";
            $("#lb").html("数据上传成功...更新报表!");
            $('#dg').datagrid('reload');

        }

    };
    //本月
    $('#by').change(function () {
        var mydate = new Date();
        var year = mydate.getFullYear();
        var month = mydate.getMonth() + 1;

        if ($('#by').is(':checked')) {
            $('#BT').datebox('setValue', year + '-' + month + '-' + '1');
            $('#ET').datebox('setValue', year + '-' + month + '-' + '30');
        }
        else {
            $('#BT').datebox('setValue', '');
            $('#ET').datebox('setValue', '');
        }
    });

    $('#sy').change(function () {
        var mydate = new Date();
        var year = mydate.getFullYear();
        var month = mydate.getMonth()


        if ($('#sy').is(':checked')) {
            $('#BT').datebox('setValue', year + '-' + month + '-' + '1');
            $('#ET').datebox('setValue', year + '-' + month + '-' + '30');

        } else {
            $('#BT').datebox('setValue', '');
            $('#ET').datebox('setValue', '');
        }
    });

  
</script>
