<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/color.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css">
    <link rel="stylesheet" type="text/css" href="../../css/fitem.css">
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../../Scripts/Common/common.js"></script>
    <script type="text/javascript" src="../../Scripts/Common/json.js"></script>
    
</head>
<body>
    <input id="equidid" type="hidden" onclick="getStandard()"/>
    <input id="getStandard" onclick="getStandard()" value="刷新" type="hidden"/>
    <div class="easyui-layout" data-options="fit:true">  
<!--        <div data-options="region:'east',split:true" style="width:320px">
            
        </div>-->
        <div data-options="region:'center'" style="padding:10px;" >
            <div class="ftitle">设备标准&nbsp;&nbsp;<input id="djName" class="easyui-combobox" style="width:200px" />
            <a href="#" class="easyui-linkbutton" icon="icon-save" onclick="addDJName();">保  存</a>
            <a href="#" class="easyui-linkbutton" icon="icon-remove" onclick="DelDJName();">删  除</a>
            <a id="And" href="#" class="easyui-linkbutton" icon="icon-save" onclick="ConnectEquipName();">关  联</a>
            <a id="cancel" href="#" class="easyui-linkbutton" icon="icon-cancel" onclick="UnConnectEquipName();">取消关联</a>
            <a id="line" href="#" class="easyui-linkbutton" icon="icon-save" onclick="openLine()">路线配置</a>
            <span id="equipName">&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
            <div class="ftitle">检查部位</div>
            <table id="dgBW" style="width:100%;"></table>
            <div class="ftitle">检查内容</div>
            <table id="dgContent" style="width:100%;"></table>
            <div class="ftitle">检查标准</div>
            <table id="dgStandard" style="width:100%;"></table>
        </div>

    </div>
        <div id="win"  class="easyui-window" title="" data-options="iconCls:'icon-save'" style="height:450px; width:970px;padding:5px;">
                <div id="tt" class="easyui-tabs" style="width:100%; height:100%" data-options="selected:1">
                    <div title="路线管理" style="padding:2px;display:none;">
		                <table id="lingdg" style="width:100%; height:100%"></table>
                    </div>
                    <div title="节点管理" data-options="closable:false" style="padding:2px;display:none;">
		                <div class="ftitle">检查内容&nbsp;&nbsp;<input id="checkcontent" class="easyui-textbox" style="width:150px"/>
                            <input id="contentID" type="hidden" value="" />
                            节点名称&nbsp;&nbsp;<input id="nodeName1" class="easyui-textbox" style="width:100px" />
                                    <a href="#" class="easyui-linkbutton" icon="icon-search" onclick="SearchNode1();">搜索</a>
                                    <a href="#" class="easyui-linkbutton" icon="icon-save" onclick="SetContentNode();">关联</a>
                                    <a href="#" class="easyui-linkbutton" icon="icon-remove" onclick="DelContentNode();">删除</a>
                        </div>
                        <div class="easyui-layout" data-options="fit:true" >  
                            <div data-options="region:'east',split:true" style="width:600px; padding:5px;">
                               
                                <table id="contentNode" style="width:100%; height:310px"></table>
                            </div>
                            <div data-options="region:'center'" style="padding:5px;" >
                                <table id="Nodedg" style="width:100%; height:310px"></table>
                            </div>

                        </div>


                        
                    </div>
                    <div title="巡检配置" data-options="closable:false" style="padding:2px;display:none;">
                        <div class="ftitle">路线名称&nbsp;&nbsp;<input id="lineName" class="easyui-combobox" />
                            <a href="#" class="easyui-linkbutton" icon="icon-reload" onclick="reloadAll();">刷新</a>
                            
                        </div>
                        <div class="easyui-layout" data-options="fit:true" >  
                            <div data-options="region:'east',split:true" style="width:380px; padding:5px;">
                                <div class="ftitle">节点名称&nbsp;&nbsp;<input id="nodeName" class="easyui-textbox" style="width:100px" />
                                    <a href="#" class="easyui-linkbutton" icon="icon-search" onclick="SearchNode();">搜索</a>
                                    <a href="#" class="easyui-linkbutton" icon="icon-save" onclick="SetNode();">配置</a>
                                    <select id="nodeIndex" class="easyui-combobox" name="dept" style="width:60px;">
                                        <option>1</option>
                                        <option>2</option><option>3</option><option>4</option><option>5</option>
                                        <option>6</option><option>7</option><option>8</option><option>9</option>
                                        <option>10</option><option>11</option><option>12</option><option>13</option>
                                        <option>14</option><option>15</option><option>16</option><option>17</option>
                                    </select>
                                </div>
                                <table id="node" style="width:100%; height:265px"></table>
                            </div>
                            <div data-options="region:'center'" style="padding:5px;" >
                                <table id="linenode" style="width:100%; height:310px"></table>
                            </div>

                        </div>
                    </div>
                </div>
        </div>

</body>
</html>
<script type="text/javascript" src="djnr.js"></script>
<script type="text/javascript">

    var dgContent = $('#dgContent');
    var dgStandard = $('#dgStandard');
    var dgBW = $('#dgBW');
    var dgLine = $('#lingdg');
    var selRow;
    var selRow1;
    var selRow2;
    var selLine;
    var effectRow;
    var effectRow1;
    var effectRow2;
    var effectRowLine;
    var editIndex = undefined;
    var editIndex1 = undefined;
    var editIndex2 = undefined;
    var editIndexLine = undefined;

    var djNameSelectID;

    $.extend($.fn.datagrid.methods, {
        keyCtr: function (jq) {
            return jq.each(function () {
                var grid = $(this);
                grid.datagrid('getPanel').panel('panel').attr('tabindex', 1).bind('keydown', function (e) {
                    switch (e.keyCode) {
                        case 38: // up
                            var selected = grid.datagrid('getSelected');
                            if (selected) {
                                var index = grid.datagrid('getRowIndex', selected);
                                grid.datagrid('selectRow', index - 1);
                                grid.datagrid('beginEdit', index - 1); //新增
                                grid.datagrid('endEdit', index); //新增
                                editIndex = index - 1;

                            } else {
                                var rows = grid.datagrid('getRows');
                                grid.datagrid('selectRow', rows.length - 1);
                                grid.datagrid('beginEdit', rows.length - 1); //新增
                                grid.datagrid('endEdit', 0); //新增
                                editIndex = rows.length - 1;
                            }
                            break;
                        case 40: // down
                            var selected = grid.datagrid('getSelected');

                            if (selected) {
                                var index = grid.datagrid('getRowIndex', selected);
                                grid.datagrid('selectRow', index + 1);
                                grid.datagrid('beginEdit', index + 1); //新增
                                grid.datagrid('endEdit', index); //新增
                                editIndex = index + 1;
                            } else {
                                var rows = grid.datagrid('getRows');
                                grid.datagrid('selectRow', 0);
                                grid.datagrid('beginEdit', 0); //新增
                                grid.datagrid('endEdit', rows.length - 1); //新增
                                editIndex = 0;
                            }
                            break;
                    }

                });
            });
        }
    });
    var company;
    var branch;
    $(function () {

        var equipselectID = parent.$('#leftFrame1').contents().find('#equidid');
        var equip_code_value = equipselectID.val();
        //        alert(equip_code_value);
        $.ajax({
            url: '../../ashx/Company/CompanyHandler.ashx?action=combo',
            dataType: 'json',
            type: 'POST',
            async: false,
            success: function (data) {
                company = data;
                //                alert(data);
            }
        });
        $('#win').window({
            title: '路线配置',
            modal: true,
            closed: true,
            minimizable: false,
            collapsible: true
        });
        $('#lingdg').datagrid({
            url: '../../ashx/sjdj/djbzHandler.ashx?type=show',
            method: 'post',
            singleSelect: true,
            collapsible: true,
            loadMsg: "正在努力加载数据，请稍后...",
            pagination: false, //分页控件
            pageSize: 20,
            pagePosition: 'bottom', //分页控件位置

            columns: [[
                { field: 'dIntLineNote', title: '路线ID', width: 70, align: 'center' },
                { field: 'dVchLine', title: '路线名称', width: 200, align: 'center', editor: "textbox" },
            ]],
            toolbar: [{
                text: '新增',
                iconCls: 'icon-add',
                handler: function () {
                    if (endEditingLine()) {
                        //                        alert('123');
                        dgLine.datagrid('appendRow', {});
                        editIndexLine = dgLine.datagrid('getRows').length - 1;
                        dgLine.datagrid('selectRow', editIndexLine)
						.datagrid('beginEdit', editIndexLine);
                    }
                }
            }, {
                text: '删除',
                iconCls: 'icon-cut',
                handler: function () {
                    if (selLine != undefined) {
                        parent.$.messager.confirm("操作提示", "您确定要执行删除操作吗？", function (data) {
                            if (data) {
                                var row = dgLine.datagrid('getSelected');
                                if (row) {
                                    var rowIndex = dgLine.datagrid('getRowIndex', row);
                                    dgLine.datagrid('deleteRow', rowIndex);
                                }
                            }
                            else {
                            }
                        });
                    }
                    else {
                        parent.$.messager.alert("操作提示", "请选择要删除的数据！", "info");
                    }
                }
            }, {
                text: '提交',
                iconCls: 'icon-undo',
                handler: function () {
                    endEditingLine();
                    if (dgLine.datagrid('getChanges').length) {
                        var inserted = dgLine.datagrid('getChanges', "inserted");
                        var deleted = dgLine.datagrid('getChanges', "deleted");
                        var updated = dgLine.datagrid('getChanges', "updated");

                        effectRowLine = new Object();
                        if (inserted.length) {
                            effectRowLine["inserted"] = JSON.stringify(inserted);
                        }
                        if (deleted.length) {
                            effectRowLine["deleted"] = JSON.stringify(deleted);
                        }
                        if (updated.length) {
                            effectRowLine["updated"] = JSON.stringify(updated);
                        }
                    }
                }
            }, {
                text: '保存',
                iconCls: 'icon-save',
                handler: function () {
                    var rows = dgLine.datagrid('getChanges');
                    if (rows.length != 0) {
                        if (effectRowLine == undefined) {
                            showMsg("操作提示", "请先进行提交操作！", "info")
                        }
                        else {
                            updateLine();
                        }
                    }

                }
            }],
            onSelect: function (index, row) {
                selLine = row;
            },
            onClickRow: function (index, row) {
                //                alert(editIndexLine); alert(index);
                if (editIndexLine != index) {
                    if (endEditingLine()) {
                        dgLine.datagrid('selectRow', index)
							.datagrid('beginEdit', index);
                        editIndexLine = index;
                    } else {
                        dgLine.datagrid('selectRow', editIndexLine);
                    }
                }
            }
        });
        dgBW.datagrid({
            url: '',
            method: 'post',
            singleSelect: true,
            collapsible: true,
            //            pagination: true, //分页控件
            //            pageSize: 20,
            //            pagePosition: 'bottom', //分页控件位置
            columns: [[
                { field: 'dIntNameNote', title: '设备名称ID', width: 80, align: 'center', hidden: 'false' },
                { field: 'dVchName', title: '设备名称', width: 210, align: 'center' },
                { field: 'dIntPartNote', title: '序列ID', width: 80, align: 'center', hidden: 'true' },
                { field: 'dVchPartName', title: '检查部位', width: 260, align: 'center', editor: { type: 'textbox', options: { required: true}} },
                { field: 'dVchRemark', title: '备注', width: 360, align: 'center', editor: "textbox" }
            ]],
            toolbar: [{
                text: '新增',
                iconCls: 'icon-add',
                handler: function () {
                    if (endEditing2()) {

                        //alert($('#djName').combobox("getValue"));
                        dgBW.datagrid('appendRow', { dVchName: $('#djName').combobox("getText"), dIntNameNote: $('#djName').combobox("getValue") });
                        editIndex2 = dgBW.datagrid('getRows').length - 1;
                        dgBW.datagrid('selectRow', editIndex2)
						.datagrid('beginEdit', editIndex2);
                    }
                }
            }, {
                text: '删除',
                iconCls: 'icon-cut',
                handler: function () {
                    if (selRow2 != undefined) {
                        parent.$.messager.confirm("操作提示", "您确定要执行删除操作吗？", function (data) {
                            if (data) {
                                var row = dgBW.datagrid('getSelected');
                                if (row) {
                                    var rowIndex = dgBW.datagrid('getRowIndex', row);
                                    dgBW.datagrid('deleteRow', rowIndex);
                                }
                            }
                            else {
                            }
                        });
                    }
                    else {
                        parent.$.messager.alert("操作提示", "请选择要删除的数据！", "info");
                    }
                }
            }, {
                text: '提交',
                iconCls: 'icon-undo',
                handler: function () {
                    endEditing2();
                    if (dgBW.datagrid('getChanges').length) {
                        var inserted = dgBW.datagrid('getChanges', "inserted");
                        var deleted = dgBW.datagrid('getChanges', "deleted");
                        var updated = dgBW.datagrid('getChanges', "updated");

                        effectRow2 = new Object();
                        if (inserted.length) {
                            effectRow2["inserted"] = JSON.stringify(inserted);
                        }
                        if (deleted.length) {
                            effectRow2["deleted"] = JSON.stringify(deleted);
                        }
                        if (updated.length) {
                            effectRow2["updated"] = JSON.stringify(updated);
                        }
                    }
                }
            }, {
                text: '保存',
                iconCls: 'icon-save',
                handler: function () {

                    var rows = dgBW.datagrid('getChanges');
                    //                    alert(rows);
                    if (rows.length != 0) {
                        if (effectRow2 == undefined) {
                            showMsg("操作提示", "请先提交编辑操作！", "info")
                        }
                        else {
                            updateB();
                        }
                    }

                }
            }, {
                text: '取消',
                iconCls: 'icon-redo',
                handler: function () {
                    //                    alert(selRow2);
                    if (selRow2 != undefined) {
                        var row = dgBW.datagrid('getSelected');
                        if (row) {
                            var rowIndex = dgBW.datagrid('getRowIndex', row);
                            dgBW.datagrid('endEdit', rowIndex);
                        }
                    }
                }
            }],

            onLoadSuccess: function (data) {
                for (var i = 0; i < data.rows.length; i++) {

                }
                if (data.rows.length > 0) {
                    selRow2 = data.rows[0];
                    dgContent.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=content&partId=' + selRow2.dIntPartNote;
                    dgContent.datagrid('reload');
                }
                else {
                    dgContent.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=content&partId=-1';
                    dgContent.datagrid('reload');

                }

            },
            onSelect: function (index, row) {
                selRow2 = row;
                dgContent.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=content&partId=' + selRow2.dIntPartNote;
                dgContent.datagrid('reload');
            },
            onClickRow: function (index, row) {
                //                alert(editIndex);
                if (editIndex2 != index) {
                    if (endEditing2()) {
                        dgBW.datagrid('selectRow', index)
							.datagrid('beginEdit', index);
                        editIndex2 = index;
                    } else {
                        dgBW.datagrid('selectRow', editIndex2);
                    }
                }
            }
        });
        //        var p2 = dgBW.datagrid('getPager');
        //        $(p2).pagination({
        //            pageSize: 20, //每页显示的记录条数，默认为20 
        //            pageList: [10, 20, 50], //可以设置每页记录条数的列表 
        //            beforePageText: '第', //页数文本框前显示的汉字 
        //            afterPageText: '页    共 {pages} 页',
        //            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        //        });

        dgContent.datagrid({
            url: '',
            method: 'post',
            singleSelect: true,
            collapsible: true,
            //            pagination: true, //分页控件
            //            pageSize: 20,
            //            pagePosition: 'bottom', //分页控件位置
            columns: [[
                { field: 'dVchPartName', title: '检查部位', width: 120, align: 'center' },
                { field: 'dIntPartNote', title: '检查部位ID', width: 80, align: 'center', hidden: 'true' },
                { field: 'dIntContentNote', title: '序列ID', width: 80, align: 'center', hidden: 'true', hidden: 'true' },
                { field: 'dVchContentName', title: '检查内容', width: 260, align: 'center', editor: { type: 'textbox', options: { required: true}} },
                { field: 'dVchRemark', title: '备注', width: 360, align: 'center', editor: "textbox" }
            ]],
            toolbar: [{
                text: '新增',
                iconCls: 'icon-add',
                handler: function () {
                    if (endEditing()) {
                        dgContent.datagrid('appendRow', { dVchPartName: selRow2.dVchPartName, dIntPartNote: selRow2.dIntPartNote });
                        editIndex = dgContent.datagrid('getRows').length - 1;
                        dgContent.datagrid('selectRow', editIndex)
						.datagrid('beginEdit', editIndex);
                    }
                }
            }, {
                text: '删除',
                iconCls: 'icon-cut',
                handler: function () {
                    if (selRow != undefined) {
                        parent.$.messager.confirm("操作提示", "您确定要执行删除操作吗？", function (data) {
                            if (data) {
                                var row = dgContent.datagrid('getSelected');
                                if (row) {
                                    var rowIndex = dgContent.datagrid('getRowIndex', row);
                                    dgContent.datagrid('deleteRow', rowIndex);
                                }
                            }
                            else {
                            }
                        });
                    }
                    else {
                        parent.$.messager.alert("操作提示", "请选择要删除的数据！", "info");
                    }
                }
            }, {
                text: '提交',
                iconCls: 'icon-undo',
                handler: function () {
                    endEditing();
                    if (dgContent.datagrid('getChanges').length) {
                        var inserted = dgContent.datagrid('getChanges', "inserted");
                        var deleted = dgContent.datagrid('getChanges', "deleted");
                        var updated = dgContent.datagrid('getChanges', "updated");

                        effectRow = new Object();
                        if (inserted.length) {
                            effectRow["inserted"] = JSON.stringify(inserted);
                        }
                        if (deleted.length) {
                            effectRow["deleted"] = JSON.stringify(deleted);
                        }
                        if (updated.length) {
                            effectRow["updated"] = JSON.stringify(updated);
                        }
                    }
                }
            }, {
                text: '保存',
                iconCls: 'icon-save',
                handler: function () {

                    var rows = dgContent.datagrid('getChanges');

                    if (rows.length != 0) {
                        if (effectRow == undefined) {
                            showMsg("操作提示", "请先提交编辑操作！", "info")
                        }
                        else {
                            updateC();
                        }
                    }

                }
            }, {
                text: '取消',
                iconCls: 'icon-redo',
                handler: function () {
                    //                    alert(selRow2);
                    if (selRow != undefined) {
                        var row = dgContent.datagrid('getSelected');
                        if (row) {
                            var rowIndex = dgContent.datagrid('getRowIndex', row);
                            dgContent.datagrid('endEdit', rowIndex);
                        }
                    }
                }
            }],

            onLoadSuccess: function (data) {
                for (var i = 0; i < data.rows.length; i++) {

                }
                if (data.rows.length > 0) {
                    selRow = data.rows[0];
                    dgStandard.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=standard&selid=' + selRow.dIntContentNote;
                    dgStandard.datagrid('reload');
                }
                else {
                    dgStandard.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=standard&selid=-1';
                    dgStandard.datagrid('reload');

                }
            },
            onSelect: function (index, row) {
                selRow = row;
                //                                alert(row.dIntContentNote);
                $('#checkcontent').textbox('setText', row.dVchContentName);
                $('#contentID').val(row.dIntContentNote);
                dgStandard.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=standard&selid=' + selRow.dIntContentNote;
                dgStandard.datagrid('reload');
            },
            onClickRow: function (index, row) {
                //                alert(editIndex);
                if (editIndex != index) {
                    if (endEditing()) {
                        dgContent.datagrid('selectRow', index)
							.datagrid('beginEdit', index);
                        editIndex = index;
                    } else {
                        dgContent.datagrid('selectRow', editIndex);
                    }
                }
            }
        });
        //        var p = dgContent.datagrid('getPager');
        //        $(p).pagination({
        //            pageSize: 20, //每页显示的记录条数，默认为20 
        //            pageList: [10, 20, 50], //可以设置每页记录条数的列表 
        //            beforePageText: '第', //页数文本框前显示的汉字 
        //            afterPageText: '页    共 {pages} 页',
        //            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        //        });

        //        dgContent.datagrid({}).datagrid("keyCtr");

        dgStandard.datagrid({
            url: '',
            method: 'post',
            singleSelect: true,
            collapsible: true,
            //            pagination: true, //分页控件
            //            pageSize: 20,
            //            pagePosition: 'bottom', //分页控件位置
            frozenColumns: [[
                { field: 'dIntContentNote', title: '序列ID', width: 80, align: 'center', hidden: 'true' },
                { field: 'dVchContentName', title: '检查内容', width: 120, align: 'center' },
                { field: 'dIntStandardNote', title: '标准ID', width: 80, align: 'center', hidden: 'true' },
                { field: 'dVchStandardName', title: '检查标准', width: 180, align: 'center', editor: { type: 'textbox', options: { required: true}} }
                ]],
            columns: [[

                { field: 'dIngCheckType1', title: '操作点检', width: 80, align: 'center', formatter: strFormatStandard, editor: { type: "combobox", options: { required: true, valueField: 'value',
                    textField: 'text',
                    editable: false,
                    panelHeight: 50,
                    data: [{
                        text: '是',
                        value: '1'
                    }, {
                        text: '否',
                        value: '0'
                    }]
                }
                }
                },
                { field: 'dIngCheckType2', title: '维保倒班', width: 80, align: 'center', formatter: strFormatStandard, editor: { type: "combobox", options: { required: true, valueField: 'value',
                    textField: 'text',
                    editable: false,
                    panelHeight: 50,
                    data: [{
                        text: '是',
                        value: '1'
                    }, {
                        text: '否',
                        value: '0'
                    }]
                }
                }
                },
                { field: 'dIngCheckType3', title: '维保白班', width: 80, align: 'center', formatter: strFormatStandard, editor: { type: "combobox", options: { required: true, valueField: 'value',
                    textField: 'text',
                    editable: false,
                    panelHeight: 50,
                    data: [{
                        text: '是',
                        value: '1'
                    }, {
                        text: '否',
                        value: '0'
                    }]
                }
                }
                },
                { field: 'dIngCheckType4', title: '专业点检', width: 80, align: 'center', formatter: strFormatStandard, editor: { type: "combobox", options: { required: true, valueField: 'value',
                    textField: 'text',
                    editable: false,
                    panelHeight: 50,
                    data: [{
                        text: '是',
                        value: '1'
                    }, {
                        text: '否',
                        value: '0'
                    }]
                }
                }
                },
                { field: 'dVchCheckMethod', title: '检查方法', width: 160, align: 'center', editor: "textbox" },
                { field: 'dIntCheckDay', title: '检查周期', width: 80, align: 'center', editor: { type: 'numberbox', options: { required: true}} },
                { field: 'dVchPostName', title: '岗位名称', width: 80, align: 'center', editor: { type: 'textbox'} },
                { field: 'dVchCheckState', title: '点检状态', width: 80, align: 'center', editor: { type: 'textbox'} },
                { field: 'dVchLevel', title: '重要级别', width: 80, align: 'center',
                    formatter: function (value, row) {
                        return value;
                    }, editor: { type: "combobox",
                        options: { required: true,
                            valueField: 'value',
                            textField: 'text',
                            editable: false,
                            panelHeight: 'auto',
                            data: [{
                                text: 'A+',
                                value: 'A+'
                            }, {
                                text: 'A',
                                value: 'A'
                            }, {
                                text: 'B',
                                value: 'B'
                            }, {
                                text: 'C',
                                value: 'C'
                            }]
                        }
                    }
                },

                { field: 'dVchExMethod', title: '异常处置', width: 120, align: 'center', editor: { type: 'textbox'} },
                { field: 'dVchSafeMethod', title: '防护措施', width: 120, align: 'center', editor: { type: 'textbox'} },
                { field: 'dVchBranchName', title: '部门', width: 150, align: 'center', editor: { type: "combotree", options: { required: true,
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    panelHeight: 'auto',
                    panelWeight: 'auto',
                    method: 'get',
                    url: ''
                }
                }
                },
                { field: 'dVchCompanyName', title: '公司', width: 150, align: 'center',
                    editor: { type: "combotree", options: {
                        data: company,
                        required: true,
                        valueField: 'id',
                        textField: 'text',
                        panelHeight: 'auto',
                        panelWeight: 'auto',
                        editable: false,
                        method: 'get',
                        onSelect: function (companyID) {
                            var row = dgStandard.datagrid('getSelected');
                            var rowIndex = dgStandard.datagrid('getRowIndex', row); //获取行号

                            var target = dgStandard.datagrid('getEditor', { 'index': rowIndex, 'field': 'dVchBranchName' }).target;
                            target.combobox('clear'); //清除原来的数据

                            target.combotree({
                                url: '../../ashx/Branch/branchHandler.ashx?action=combo&branch_parent=0&company_id=' + companyID.id,
                                animate: true,
                                onLoadSuccess: function (node, data) {
                                    var t = target.combotree('tree'); //获取tree  
                                    for (var i = 0; i < data.length; i++) {
                                        node = t.tree("find", data[i].id);
                                        t.tree('expandAll', node.target); //展开所有节点  
                                    }
                                }
                            });
                        }
                    }
                    }
                }
            ]],
            toolbar: [{
                text: '新增',
                iconCls: 'icon-add',
                handler: function () {
                    if (endEditing1()) {
                        dgStandard.datagrid('appendRow', { dIntContentNote: selRow.dIntContentNote, dVchContentName: selRow.dVchContentName });
                        editIndex1 = dgStandard.datagrid('getRows').length - 1;
                        dgStandard.datagrid('selectRow', editIndex1)
						.datagrid('beginEdit', editIndex1);
                    }
                }
            }, {
                text: '删除',
                iconCls: 'icon-cut',
                handler: function () {
                    if (selRow1 != undefined) {
                        parent.$.messager.confirm("操作提示", "您确定要执行删除操作吗？", function (data) {
                            if (data) {
                                var row = dgStandard.datagrid('getSelected');
                                if (row) {
                                    var rowIndex = dgStandard.datagrid('getRowIndex', row);
                                    dgStandard.datagrid('deleteRow', rowIndex);
                                }
                            }
                            else {
                            }
                        });
                    }
                    else {
                        parent.$.messager.alert("操作提示", "请选择要删除的数据！", "info");
                    }
                }
            }, {
                text: '提交',
                iconCls: 'icon-undo',
                handler: function () {
                    endEditing1();
                    if (dgStandard.datagrid('getChanges').length) {

                        var inserted = dgStandard.datagrid('getChanges', "inserted");
                        var deleted = dgStandard.datagrid('getChanges', "deleted");
                        var updated = dgStandard.datagrid('getChanges', "updated");

                        effectRow1 = new Object();
                        if (inserted.length) {
                            effectRow1["inserted"] = JSON.stringify(inserted);
                        }
                        if (deleted.length) {
                            effectRow1["deleted"] = JSON.stringify(deleted);
                        }
                        if (updated.length) {
                            effectRow1["updated"] = JSON.stringify(updated);
                        }
                    }
                }
            }, {
                text: '保存',
                iconCls: 'icon-save',
                handler: function () {

                    var rows = dgStandard.datagrid('getChanges');
                    //                    alert(effectRow1);
                    if (rows.length != 0) {
                        if (effectRow1 == undefined) {
                            showMsg("操作提示", "请先提交操作！", "info")
                        }
                        else {
                            updateS();
                        }
                    }

                }
            }, {
                text: '取消',
                iconCls: 'icon-redo',
                handler: function () {
                    //                    alert(selRow2);
                    if (selRow1 != undefined) {
                        var row = dgStandard.datagrid('getSelected');
                        if (row) {
                            var rowIndex = dgStandard.datagrid('getRowIndex', row);
                            dgStandard.datagrid('endEdit', rowIndex);
                        }
                    }
                }
            }],

            onLoadSuccess: function (data) {
                for (var i = 0; i < data.rows.length; i++) {

                }

            },
            onSelect: function (index, row) {
                selRow1 = row;
            },
            onClickRow: function (index, row) {
                if (editIndex1 != index) {
                    if (endEditing1()) {
                        dgStandard.datagrid('selectRow', index)
							.datagrid('beginEdit', index);
                        editIndex1 = index;
                    } else {
                        dgStandard.datagrid('selectRow', editIndex1);
                    }
                }
            }
        });
        //        var p1 = dgStandard.datagrid('getPager');
        //        $(p1).pagination({
        //            pageSize: 20, //每页显示的记录条数，默认为20 
        //            pageList: [10, 20, 50], //可以设置每页记录条数的列表 
        //            beforePageText: '第', //页数文本框前显示的汉字 
        //            afterPageText: '页    共 {pages} 页',
        //            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        //        });
        $('#djName').combobox({
            url: '../../ashx/sjdj/sjdjHandler.ashx?type=name',
            valueField: 'dIntNameNote',
            textField: 'dVchName',
            panelHeight: '500px',
            onSelect: function (param) {
                //                alert(param.dIntNameNote);
                djNameSelectID = param.dIntNameNote;
                dgBW.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=bw&nameId=' + param.dIntNameNote;
                dgBW.datagrid('reload');

            }
        });
    });
    function DelDJName() {
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=DelName&nid=" + djNameSelectID,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    showMsg("操作提示", "数据删除成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据删除失败！", "error")
                }
            }
        })

        $('#djName').combobox('reload');
    }
    function addDJName() {
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=saveName&name=" + encodeURIComponent($('#djName').combobox("getText")) + "&nid=" + djNameSelectID,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    showMsg("操作提示", "数据更新成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据更新失败！", "error")
                }
            }
        })

        $('#djName').combobox('reload');
    }
    function getStandard() {
//        alert($('#equidid').val());
//        $('#djName').combobox('select', 2);
        $('#djName').combobox('clear');

        var data = {
            equipCode: $('#equidid').val()
        };
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=byEquipCode",
            data: data,
            type: 'post',
            dataType: 'text',
            success: function (msg) {
                if (msg != '') {
                    $('#djName').combobox('select', msg);

                    $('#And').linkbutton('disable');
//                    dgBW.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=bw&nameId=' + msg;
//                    dgBW.datagrid('reload');
                }
                else {
                    //                    alert(msg);
//                    $('#djName').combobox('unselect', msg);

                    dgBW.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=bw&nameId=-1';
                    dgBW.datagrid('reload');
                    $('#And').linkbutton('enable');
//                    dgContent.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=content&partId=-1';
//                    dgContent.datagrid('reload');

//                    dgStandard.datagrid('options').url = '../../ashx/sjdj/sjdjHandler.ashx?type=standard&selid=-1';
//                    dgStandard.datagrid('reload');
                    //                    dgBW.datagrid('clear');
                    //                    dgStandard.datagrid('clear');
                    //                    dgContent.datagrid('clear');
                }

            }
        })
    }
    function UnConnectEquipName() {
        if ($('#equidid').val() == "") {
            //            alert($('#djName').combobox("getValue"));
            showMsg("操作提示", "请先选择一台设备！", "error");
            return;
        }
        //                alert("../../ashx/sjdj/sjdjHandler.ashx?type=And&nameId=" + $('#djName').combobox("getValue") + "&equipCode = " + $('#equidid').val());
        //关联操作
        var data = {
            nameId: $('#djName').combobox("getValue"),
            equipCode: $('#equidid').val()
        };
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=UnAnd",
            data: data,
            type: 'post',
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    showMsg("操作提示", "取消关联成功！", "info")
                }
                else {
                    showMsg("操作提示", "取消关联失败！", "error")
                }
            }
        })
    }
    function ConnectEquipName() {
        if ($('#equidid').val() == "") {
//            alert($('#djName').combobox("getValue"));
            showMsg("操作提示", "请先选择一台设备！", "error");
            return;
        }
//                alert("../../ashx/sjdj/sjdjHandler.ashx?type=And&nameId=" + $('#djName').combobox("getValue") + "&equipCode = " + $('#equidid').val());
        //关联操作
        var data = {
            nameId: $('#djName').combobox("getValue"),
            equipCode: $('#equidid').val()
        };
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=And",
            data: data,
            type: 'post',
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    showMsg("操作提示", "数据关联成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据关联失败！", "error")
                }
            }
        })
    }
    function updateC() {
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=saveC",
            data: effectRow,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    dgContent.datagrid('acceptChanges');
                    showMsg("操作提示", "数据更新成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据更新失败！", "error")
                }
            }
        })

        dgContent.datagrid('reload');
    }
    function updateS() {
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=saveS",
            data: effectRow1,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    dgStandard.datagrid('acceptChanges');
                    showMsg("操作提示", "数据更新成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据更新失败！", "error")
                }
            }
        })

        dgStandard.datagrid('reload');
    }
    function updateB() {
        $.ajax({
            url: "../../ashx/sjdj/sjdjHandler.ashx?type=saveB",
            data: effectRow2,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    dgBW.datagrid('acceptChanges');
                    showMsg("操作提示", "数据更新成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据更新失败！", "error")
                }
            }
        })

        dgBW.datagrid('reload');
    }
    function updateLine() {
        $.ajax({
            url: "../../ashx/sjdj/djbzHandler.ashx?type=saveLine",
            data: effectRowLine,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                if (msg == 'ok') {
                    dgLine.datagrid('acceptChanges');
                    showMsg("操作提示", "数据更新成功！", "info")
                }
                else {
                    showMsg("操作提示", "数据更新失败！", "error")
                }
            }
        })

        dgLine.datagrid('reload');
    }
    function endEditing() {
        if (editIndex == undefined) { return true }
        if (dgContent.datagrid('validateRow', editIndex)) {
            dgContent.datagrid('endEdit', editIndex);
            editIndex = undefined;
            return true;
        } else {
            return false;
        }
    }

    function endEditing1() {
        if (editIndex1 == undefined) { return true }
        if (dgStandard.datagrid('validateRow', editIndex1)) {
            dgStandard.datagrid('endEdit', editIndex1);
            editIndex1 = undefined;
            return true;
        } else {
            return false;
        }
    }
    function endEditing2() {
        if (editIndex2 == undefined) { return true }
        if (dgBW.datagrid('validateRow', editIndex2)) {
            dgBW.datagrid('endEdit', editIndex2);
            editIndex2 = undefined;
            return true;
        } else {
            return false;
        }
    }

    function endEditingLine() {
        if (editIndexLine == undefined) { return true }
        if (dgLine.datagrid('validateRow', editIndexLine)) {
            dgLine.datagrid('endEdit', editIndexLine);
            editIndexLine = undefined;
            return true;
        } else {
            return false;
        }
    }
    var selContentNode;
    function openLine() {
        $('#win').window('open');

        
        $('#contentNode').datagrid({
            url: '../../ashx/sjdj/djbzHandler.ashx?type=ShowContentNode&contentID=' + $('#contentID').val(),
            method: 'post',
            singleSelect: true,
            collapsible: true,
            loadMsg: "正在努力加载数据，请稍后...",
            pagination: false, //分页控件
            pageSize: 20,
            pagePosition: 'bottom', //分页控件位置

            columns: [[
                { field: 'dVchContentName', title: '检查内容', width: 108, align: 'center' },
                { field: 'dVchLine', title: '路线名称', width: 228, align: 'center' },
                { field: 'dVchNode', title: '节点名称', width: 228, align: 'center' },
                { field: 'dIntNodeNote', title: '节点ID', width: 30, align: 'center', hidden: true },
                { field: 'dIntContentNote', title: '内容ID', width: 30, align: 'center', hidden: true }
            ]],

            onSelect: function (index, row) {
                selContentNode = row;
            }
        });
    }

    function DelContentNode() {
        var data = {
            nodeId: selContentNode.dIntNodeNote,
            contentID: selContentNode.dIntContentNote
        }

        $.ajax({
            url: "../../ashx/sjdj/djbzHandler.ashx?type=DelContentNode",
            data: data,
            type: 'post',
            async: false,
            dataType: 'text',
            success: function (msg) {
                //                alert(msg);
                if (msg == 'ok') {
                    showMsg("操作提示", "删除检查内容与节点的关系成功！", "info")
                }
                else {
                    showMsg("操作提示", "删除检查内容与节点的关系失败！", "error")
                }
            }
        });
        $('#contentNode').datagrid('reload');
    }
</script>