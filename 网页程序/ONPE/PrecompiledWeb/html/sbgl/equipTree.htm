<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css">
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
    <script src="../../Scripts/Common/common.js" type="text/javascript"></script>
</head>
<body>
    <input type="hidden" id="refreshtree" onclick="RefreshTree()" />
    <input type="hidden" id="equidid" />
    <input type="hidden" id="equidname" />
    <div id="loading" style="width: 200px; display: none">
        <img src="../../img/loading.gif" style="width: 16px; height: 16px;"></img>
        Loading......
    </div>
    <ul id="tt" class="easyui-tree" style="padding-top: 6px">
    </ul>
</body>
</html>
<script type="text/javascript">
    function getNode(node) {
        var currentPageTitle = getCurrentPageTitle();
        if (currentPageTitle == '任务工单') {
            var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#equipId");
            object1.val(node.id);
        }
        if (getCurrentPageTitle() == '工作票') {
            var object2 = $("#equipId", parent.document);
            object2.val(node.id + "," + node.text);
        }
    }
    function RefreshTree() {
        loadEquipTree();
    };
    $(document).ready(function () {
        loadEquipTree();
    });
    $(document).ready(function () {
        $(document).focusin(function () {
            var s = parent.document.getElementById('rr');
            s.children
        });
    });

    var loadEquipTree = function () {
        $('#tt').tree({
            checkbox: false,
            animate: true,
            url: '../../ashx/sbgl/areaHandler.ashx?action=tree&area_parent=0',
            onBeforeExpand: function (node, param) {
                if (node.attributes == 'area') {
                    $('#tt').tree('options').url = "../../ashx/sbgl/areaHandler.ashx?action=tree&area_parent=" + node.id;
                }
                if (node.attributes == 'lastArea') {

                    $('#tt').tree('options').url = "../../ashx/sbgl/equipHandler.ashx?action=tree&area_id=" + node.id;
                }
                if (node.attributes == 'equip') {
                    $('#tt').tree('options').url = "../../ashx/sbgl/equipHandler.ashx?action=tree&equip_parent=" + node.id;
                }
                if (node.attributes == 'equip' || node.attributes == 'lastEquip') {
                    getNode(node);
                }
            },
            onSelect: function (node) {
                $('#equidid').val("");
                $('#equidname').val("");
                $('#tt').tree(node.state === 'closed' ? 'expand' : 'collapse', node.target);

                if (node.attributes == 'area' || node.attributes == 'lastArea') {
                    parent.LoadPropertyData('ashx/sbgl/areaHandler.ashx?action=prop&area_id=' + node.id);
                }
                if (node.attributes == 'equip' || node.attributes == 'lastEquip') {
                    parent.LoadPropertyData('ashx/sbgl/equipHandler.ashx?action=prop&equip_code=' + node.id);

                    $('#equidid').val(node.id.replace(/<[^>]+>/g, ""));
                    $('#equidname').val(node.text.replace(/<[^>]+>/g, ""));
                    var currentPageTitle = getCurrentPageTitle();
                    if (currentPageTitle == '点检管理') {
                        var object1 = parent.$('#mainFrame' + currentPageTitle).contents().find("#equidid");
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#equipName");

                        object1.val(node.id);
                        object2.html(node.text.replace(/<[^>]+>/g, ""));

                        object1.click();
                    }
                    if (currentPageTitle == 'PLC点地址关联') {
                        var object1 = parent.$('#mainFrame' + currentPageTitle).contents().find("#ddzRef");
                        var object2 = parent.$('#mainFrame' + currentPageTitle).contents().find("#ddzname");
                        var object3 = parent.$('#mainFrame' + currentPageTitle).contents().find("#idsb");

                        object1.val(node.id);
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        object3.val(node.text.replace(/<[^>]+>/g, ""));
                        object1.click();
                    }

                    if (currentPageTitle == 'PLC综合查询') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#iplczh");
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#isb");
                        object1.val(node.id);
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        object1.click();
                    }
                    if (currentPageTitle == 'PLC点地址') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#isb");
                        object1.val(node.id);
                        object1.click();
                    }
                    if (currentPageTitle == '设备图纸') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#getEquipCodeAndRefresh");
                        object1.val(node.id);
                        object1.click();
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_name");
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        var object3 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_code");
                        object3.val(node.id);
                    }
                    if (currentPageTitle == '设备定位') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#getEquipCodeAndRefresh");
                        object1.val(node.id);
                        object1.click();
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_name");
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        var object3 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_code");
                        object3.val(node.id);
                    }
                    if (currentPageTitle == '三大规程') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#getEquipCodeAndRefresh");
                        object1.val(node.id);
                        object1.click();
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_name");
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        var object3 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_code");
                        object3.val(node.id);
                    }
                    if (currentPageTitle == '应急预案') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#getEquipCodeAndRefresh");
                        object1.val(node.id);
                        object1.click();
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_name");
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        var object3 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_code");
                        object3.val(node.id);
                    }
                    if (currentPageTitle == '故障案例') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#getEquipCodeAndRefresh");
                        object1.val(node.id);
                        object1.click();
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_name");
                        object2.val(node.text.replace(/<[^>]+>/g, ""));
                        var object3 = parent.$("#mainFrame" + currentPageTitle).contents().find("#select_equip_code");
                        object3.val(node.id);
                    }
                    if (currentPageTitle == '点检记录') {
                        var object1 = parent.$("#mainFrame" + currentPageTitle).contents().find("#search_equip_code");
                        object1.val(node.id);
                        object1.click();
                        var object2 = parent.$("#mainFrame" + currentPageTitle).contents().find("#search_equip_name");
                        object2.html(node.text.replace(/<[^>]+>/g, ""));
                    }
                }
            },
            onBeforeLoad: function (node, param) {
                $('#loading').show();
            },
            onLoadSuccess: function (node, data) {
                $('#loading').hide();
            }
        });
    }
</script>
