<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>plc动态添加</title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/color.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css">
    <link href="../../css/fitem.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
		.item-img{
			display:inline-block;
			vertical-align:middle;
			width:16px;
			height:16px;
		}
		.item-text{
			display:inline-block;
			vertical-align:middle;
			padding:3px 0 3px 3px;
		}
	</style>

    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../Scripts/Module/timer.js"></script>
    <script src="Highcharts-4.2.6/js/highcharts.js"></script>
    <script src="Highcharts-4.2.6/js/modules/exporting.js"></script>
    <script src="../../Scripts/Common/common.js" type="text/javascript"></script>
    <!--<script src="../../Scripts/PLC/webPlcSerch.js" type="text/javascript"></script>-->
</head>
<body>
    <div class="layout" data-options="fit:true">
        <div data-options="region:'north',border:false">
            <input type="hidden" id="iplczh" onclick="loadcombobox()" />
            <input type="hidden" id="ieqd" />
            <input type="hidden" id="iddzid" onclick="loadddz()" />
            <form id="fm1" method="post">
                <div class="ftitle">
                    设备点地址选择</div>
                <label>
                    设备名称:</label>
                <input id="isb" name="nsb" />
                <label>
                    点地址:</label>
                <input id="iddz" name="nddz" />
                <label>
                    实际范围:<input id="isbSjMin" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'"/>-</label><input id="isbSjMax" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'"/>
                <label>
                    标定范围:<input id="isbBdMin" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'"/>-</label><input id="isbBdMax" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'" />
                <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="queren()">确认</a>
                </div>
        </form>
        <div data-options="region:'center',border:false">
            <div class="ftitle">
                动态点地址添加</div>
            <form id="fm" method="post" novalidate>
            <div class="fitem">
                <label style="text-align:right;">点名称:</label>
                 <input id="iName" name="nName" class="easyui-textbox" />
            </div>
            <div class="fitem">
                <label style="text-align:right;">厂别:</label>
                   <input id="ifactory" class="easyui-combobox" name="nfactory" />
            </div>
            <div class="fitem">
                <label style="text-align:right;">
                    plc:</label>
                        <input id="iplc" class="easyui-combobox" name="nplc"/>
            </div>
            <div class="fitem">
                <label style="text-align:right;">
                    点地址:</label>
                <!--<input id="plclb" name="nplclb" class="easyui-combobox" />-->
                <input id="iadress" name="naddress" />
                <label style="text-align:right;">变量类型:</label>
                <input id="iVariableType" name="nVariableType"/>
              <!--   <input type="radio" id="ibd" name="ZongGZ" value="1" style="width:15px; " />是
                  <input type="radio" id="ibd1" name="ZongGZ" value="0" style="width:15px;"  checked="checked" />否-->
                <label style="text-align:right;">
                    实际范围:</label>
                <input id="isjMin" name="nsjMin"  style="width: 40px" 
                    class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'" 
                    />
                -
                <input id="isjMax" name="nsjMax"  style="width: 40px" 
                    class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'" 
                    />
                <label style="text-align:right;">
                    标定范围:</label>
                <input id="ibdMin" name="nbdMin"  style="width: 40px" 
                    class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'" 
                    />
                -
                <input id="ibdMax" name="nbdMax"  style="width: 40px" 
                    class="easyui-validatebox" data-options="required:true,validType:'intOrFloat',missingMessage:'请填写数字'" 
                    />
            </div>
            <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="save()">保存</a>
            <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="qingkong()">清空</a>
            <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="begin()">开始</a>
            <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="stop()">结束</a>
            </form>
            <table id="dg" title="plc点地址数据值">
            </table>
        </div>
        <div data-options="region:'south',border:false">
            <input id="abc" name="nabc" value="0" type="hidden" />
            <div class="ftitle">
                PLC选择</div>
            <div class="fitem">
                <label>
                    选择点地址：</label>
                <input id="a1" name="na1" type="hidden" />
                <input id="a2" name="na2" type="hidden" />
                <input id="a3" name="na3" />
                <input id="a4" name="na4" type="hidden" />
                <label style="text-align: right">
                    实际范围：</label>
                <input id="idSjMin" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat'" value="0"/>
                -
                <input id="idSjMax" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat'" value="1"/>
                <label style="text-align: right">
                    标定范围：</label>
                <input id="idBdMin" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat'" value="0"/>
                -
                <input id="idBdMax" style="width: 40px" class="easyui-validatebox" data-options="required:true,validType:'intOrFloat'" value="1"/>
                <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="xuanzhong()">确定</a>
            </div>
            <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto">
            </div>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    var temp = 0;
    var sbddzid = "";
    var sbFactorybm = "";
    var sbplcbm = "";
    var sbddz;
    var sbcjdz = "";
    var sbFwqdh = "";
    var sbName = "";
    var sVT = "";

    var dFactorybm;
    var dplcbm;
    var dddz;
    var dbcjdz;
    var dFwqdh;

    var vfwqdh;
    var vplcstate;
    var aaa;

    var jsl;
    $(document).ready(function () {
        LoadFactory();
        LoadPlc();
        LoadVariableType();
        //        Loadpd();
   
        var var_equidid = parent.$("#leftFrame1").contents().find("#equidid");
        var var_equidName = parent.$("#leftFrame1").contents().find("#equidname");

        // var var_equidid = $(parent.frames['leftFrame1'].document).find('#equidid');
        //  var var_equidName = $(parent.frames['leftFrame1'].document).find('#equidname');
        equid_code = var_equidid.val();
        equid_name = var_equidName.val();
        $('#dg').datagrid({
            idField: "dIntDataID",
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=grid',
            method: 'post',
            loadMsg: "正在努力加载数据，请稍后...",
            pagination: true, //分页控件
            remoteSort: true,
            pagePosition: 'bottom', //分页控件位置
            rownumbers: true,
            singleSelect: true,
            selectOnCheck: true,
            checkOnSelect: true,
            onLoadSuccess: function (data) {
                if (data) {
                    $.each(data.rows, function (index, item) {
                        if (item.checked) {
                            $('#dg').datagrid('checkRow', index);
                        }
                    });
                }
            },
            columns: [[
                { field: 'ck', checkbox: true },
                { field: 'dIntDataID', title: '数据ID', width: 60, align: 'center', hidden: true },
                { field: 'dVchFactoryCode', title: '厂别代号', width: 100, align: 'center', hidden: true },
                { field: 'equip_name', title: '设备名称', width: '10%', align: 'center' },
                { field: 'dVchName', title: '点名称', width: '10%', align: 'center' },
                { field: 'dVchFactoryName', title: '厂别', width: '10%', align: 'center',hidden:true },
                { field: 'dVchPLCCode', title: 'PLC编码', width: 100, align: 'center', hidden: true },
                { field: 'dVchRemark', title: 'PLC', width: '30%', align: 'center' },
                { field: 'dVchAdress', title: '地址', width: '20%', align: 'center' },
                { field: 'dVchCjdz', title: '采集地址', width: 100, align: 'center', hidden: true },
                { field: 'dVchValue', title: '实时值', width: '10%', align: 'center'
                    //                    formatter: function (value, row, index) {
                    //                    if (row.dFltBdMax < value || row.dFltBdMin > value) {
                    //                        return '量程有误';
                    //                    }
                    //                    else {
                    //                        return value;
                    //                    }
                    //                }
                },

                { field: 'dVchSjValue', title: '转换值', width: '10%', align: 'center' },
                { field: 'dVchUnit', title: '单位', width: 100, align: 'center', hidden: true },
                { field: 'dIntDqBz', title: '读取标识', width: 400, align: 'center', hidden: true },
                { field: 'dFltSjMax', title: '', align: 'center', hidden: true },
                { field: 'dFltSjMin', title: '', align: 'center', hidden: true },
                { field: 'dFltBdMax', title: '', align: 'center', hidden: true },
                { field: 'dFltBdMin', title: '', align: 'center', hidden: true }

            ]],
            toolbar: [{
                text: '删除',
                iconCls: 'icon-cut',
                handler: function () { remove() }
            },{
                text:'变更',
                iconCls:'icon-del',
                handler:function(){GetHistory()}
            }]

        });
        var p = $('#dg').datagrid('getPager');
        $(p).pagination({
            pageSize: 10, //每页显示的记录条数，默认为10 
            pageList: [10, 20, 30], //可以设置每页记录条数的列表 
            beforePageText: '第', //页数文本框前显示的汉字 
            afterPageText: '页    共 {pages} 页',
            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        });

        $('#sgyxt').combobox({
            url: '../../ashx/plc/plcgyxt.ashx',
            method: 'get',
            valueField: 'id',
            textField: 'text',
            panelHeight: 'auto'
        });

        //combobox
        $('#iddz').combogrid({
            panelWidth: 500,
            url: '../../ashx/plc/ahplcddz.ashx?action=combobox',
            required: true,
            method: 'get',
            idField: 'dVchPLCAddress',
            textField: 'dVchAddress',
            columns: [[
                { field: 'dIntDataID', title: '点地址ID', width: 60, align: 'right', hidden: true },
				{ field: 'dVchAddress', title: '点地址', width: 60, align: 'right' },
                { field: 'dVchAdressName', title: '名称', width: 100, align: 'right' },
                { field: 'dVchAllAdress', title: '采集地址', align: 'right', hidden: true },
                { field: 'dVchFactoryCode', title: '厂名编码', align: 'right', hidden: true },
                { field: 'dVchFactoryName', title: '厂名', align: 'right', hidden: true },
                { field: 'dVchPLCbianma', title: 'PLC编码', align: 'right', hidden: true },
                { field: 'dVchDescription', title: '详细描述', width: 200, align: 'right' },
                { field: 'dFltMoniMax', title: '', align: 'right', hidden: true },
                { field: 'dFltMoniMin', title: '', align: 'right', hidden: true },
                { field: 'dFltSjMax', title: '', align: 'right', hidden: true },
                { field: 'dFltSjMin', title: '', align: 'right', hidden: true },
                { field: 'dVchFwqdh', title: '', align: 'right', hidden: true }
			]],
            fitColumns: true,
            onSelect: function () {
                var grid = $('#iddz').combogrid('grid');
                var row = grid.datagrid('getSelected');
                // $('#a1').val(row.dVchFactoryCode);
                // $('#a2').val(row.dVchPLCbianma);
                // $('#a3').val(row.dVchAllAdress);
                sbddzid = row.dIntDataID;
                sbFactorybm = row.dVchFactoryCode;
                sbplcbm = row.dVchPLCbianma;
                sbcjdz = row.dVchAllAdress;
                sbFwqdh = row.dVchFwqdh;
                sbName = row.dVchDescription;
                sVT = row.dVchDataType;
                $('#isbSjMax').val(row.dFltMoniMax);
                $('#isbSjMin').val(row.dFltMoniMin);
                $('#isbBdMax').val(row.dFltSjMax);
                $('#isbBdMin').val(row.dFltSjMin);
                jsl = row.dIntJsBz;
            }
        });

        //图表
        Highcharts.setOptions({
            global: {
                useUTC: false
            }
        });

        $('#container').highcharts({
            chart: {
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
                    load: function () {
                        // set up the updating of the chart each second
                        var series = this.series[0];

                        setInterval(function () {
                            //根据每一次数值变化，把X值与Y值传入此X，Y中即可

                            var x = (new Date()).getTime(), // current time
                            //   y = Math.random();
                                 y = parseInt($("#abc").attr("value"));
                            series.addPoint([x, y], true, true);
                        }, 3000);

                    }
                }
            },
            title: {
                text: '动态数据曲线图'
            },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150
            },
            yAxis: {
                title: {
                    text: 'Value'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.series.name + '</b><br/>' +
                        Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                        Highcharts.numberFormat(this.y, 2);
                }
            },
            legend: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            series: [{
                name: 'Random data',
                data: (function () {
                    // generate an array of random data
                    var data = [],
                        time = (new Date()).getTime(),
                        i;
                    for (i = -10; i <= 0; i += 1) {
                        data.push({
                            x: time + i * 1000,
                            y: null
                        });
                    }
                    return data;
                } ())
            }]
        });
        //end 图表

    });




    function queren() {
        var equipInfo = {
            nfactory: sbFactorybm,
            nplc: sbplcbm,
            naddress: $('#iddz').combobox('getText'),
            ncjdz: sbcjdz,
            nsjmax: $('#isbSjMax').val(),
            nsjmin: $('#isbSjMin').val(),
            nbdmax: $('#isbBdMax').val(),
            nbdmin: $('#isbBdMin').val(),
            nFwqdh: sbFwqdh,
            nNm: sbName,
            nddzid: sbddzid,
            nSbbm: $("#iplczh").val(),
            nVT: sVT,
            njsl:jsl
        };

        if ($('#fm1').form('validate') == true) {
//            $("#fm1").submit();
            $.ajax({
                type: 'post',
                url: '../../ashx/plc/ahPlcDtTemp.ashx?action=add',
                data: equipInfo,
                dataType: 'text',
                success: function (msg) {
                    if (msg == "0") {
                        parent.$.messager.alert("操作提示", "保存成功", "info");
                        $('#dg').datagrid('reload');

                    } else {
                        // $.messager.show({
                        //    title: 'Error',
                        //    msg: msg
                        // });
                        showMsg("Error", msg);
                    }
                }
            });
        }
    }

    function save() {
        var ndata = {
            nfactory: $('#ifactory').combobox('getValue'),
            nplc: $('#iplc').combobox('getValue'),
            // naddress: $('#plclb').combobox('getText') + $('#iadress').val(),
            naddress: $('#iadress').val(),
            nsjmax: $('#isjMax').val(),
            nsjmin: $('#isjMin').val(),
            nbdmax: $('#ibdMax').val(),
            nbdmin: $('#ibdMin').val(),
            nNm: $('#iName').textbox('getValue'),
            nfwqdh: vfwqdh,
            nddzid:'',
            nSbbm:'',
            nVT: $('#iVariableType').combobox('getValue')

        };

        $.ajax({
            type: 'post',
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=add',
            data: ndata,
            dataType: 'text',
            success: function (msg) {
                if (msg == "0") {
                    //                parent.$.messager.alert("操作提示", "保存成功", "info");
                    $('#dg').datagrid('reload');

                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: msg
                    });
                }
            }
        });
    }

    function qingkong() {
        $('#ifactory').combobox('clear');
        $('#iplc').combobox('clear');
        $('#iadress').val("");
//        $('#plclb').combobox('setText', '');

    }

    function begin() {
        $('body').everyTime('5s', function () {
            $('#dg').datagrid('reload');
            var checkedItems = $('#dg').datagrid('getChecked');
            var names = [];
            $.each(checkedItems, function (index, item) {
                temp = item.dVchValue;
                $("#abc").attr("value", temp); //
            });
        });
    }
    function stop() {
        $('body').stopTime();
    }


    function ChangeZ()
    {
        var row = $('#dg').datagrid('getSelected');
        var data1 = {
            vDid:row.dIntDataID
        };

        $.ajax({
            type: 'post',
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=tc',
            data: data1,
            dataType: 'text',
            success: function (msg) {
                if (msg == "1") {
                    parent.$.messager.alert("操作提示", "变更成功！", "info");

                    $('#dg').datagrid('reload');
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: "变更失败！"
                    });
                }
            }
        });
    }
    //历史数据设置
    function GetHistory()
    {
        var row = $('#dg').datagrid('getSelected');
        var para = {vDid:row.dIntDataID};

        $.ajax({
            type:'post',
            url:'../../ashx/plc/ahPlcDtTemp.ashx?action=hs',
            data:para,
            dataType:'text',
            success:function (msg){
                if(msg == 0)
                {
                    parent.$.messager.alert("操作提示","变更成功！","info");
                    $('#dg').datagrid('reload');
                }else{
                    $.messager.show({
                        title:'Error',
                        msg:"变更失败！"
                    });
                }
            }
        });
    }
    function remove() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $.messager.confirm('Confirm', '你确定要删除这条记录吗?', function (r) {
                if (r) {
                    $.post('../../ashx/plc/ahPlcDtTemp.ashx?action=del&vID=' + row.dIntDataID, { cj: row.dVchCjdz }, function (result) {
                        if (result == 0) {
                            $('#dg').datagrid('reload'); // reload the user data
                        } else {
                            $.messager.show({	// show error message
                                title: 'Error',
                                msg: result.msg
                            });
                        }
                    }, 'text');
                }
            });
        }
    }


    function doSearch() {
        $('#dg').datagrid('load', {
            plcname: $('#splcname').val(),
            gyxt: $('#sgyxt').combobox('getValue')
        });

    }
    function loadcombobox() {
        var temp = $("#iplczh").val();
        //$('#iddz').combogrid('reload', '../../ashx/plc/ahplcddz.ashx?action=combobox&eqd=' + temp);
        
        $('#iddz').combogrid('grid').datagrid('load', {
            eqd: temp
        });
    }

    function loadddz() {
        var iddz = $('#iddzid').val();

        var datas = {
            iddz: $('#iddzid').val()
        };
        $.ajax({
            type: 'post',
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=ddzid',
            data: datas,
            dataType: 'text',
            success: function (msg) {
                $('#a1').val(msg.split(',')[0]);
                $('#a2').val(msg.split(',')[1]);
                $('#a3').val(msg.split(',')[2]);
                $('#a4').val(msg.split(',')[3]);

                $('#idSjMax').val(msg.split(',')[4]);
                $('#idSjMin').val(msg.split(',')[5]);
                $('#idBdMax').val(msg.split(',')[6]);
                $('#idBdMin').val(msg.split(',')[7]);
                dFwqdh = msg.split(',')[8];
            }
        });
    }

    //修改绑定Combobox
    function LoadFactory() {
        $('#ifactory').combobox({
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=Area',
            method: 'get',
            required: true,
            valueField: 'dIntAreaID',
            textField: 'dVchArea',
            panelHeight: 'auto',
            onSelect: function (rec) {
                $('#iplc').combobox({
                    url: '../../ashx/plc/ahPlcDtTemp.ashx?action=plc&cb=' + rec.dIntAreaID,
                    method: 'get',
                    valueField: 'dVchPLCbianma',
                    textField: 'dVchRemark',
                    panelHeight: '200',
                    panelWidth: '200',
                    onSelect: function (rec) {
                        var datas = {
                            vplcbm: rec.dVchPLCbianma
                        };

//                        $.ajax({
//                            type: 'post',
//                            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=gpp',
//                            data: datas,
//                            dataType: 'text',
//                            success: function (msg) {
//                                vfwqdh = msg.split(',')[1];
//                                $('#plclb').combobox({
//                                    width: 60,
//                                    url: '../../ashx/plc/ahPlcDtTemp.ashx?action=ppgz&vpp=' + msg.split(',')[0],
//                                    method: 'get',
//                                    valueField: 'dIntGZID',
//                                    textField: 'dVchGZQZ',
//                                    panelHeight: 'auto'
//                                });
//                            }
//                        });
                    }
                });
            }
        });
    }
    function LoadPlc() {
        $('#iplc').combobox({
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=plc',
            method: 'get',
            required: true,
            valueField: 'dVchPLCbianma',
            textField: 'dVchRemark',
            panelHeight: '200',
            panelWidth: '200',
            formatter: function (row) {
                var imageFile = 'images/' + row.icon;
                return '<img class="item-img" src="' + imageFile + '"/><span class="item-text">' + row.dVchRemark + '</span>';
            }
            //        onSelect: function (rec) {
            //            var datas = {
            //                vplcbm: rec.dVchPLCbianma
            //            };
            //            $.ajax({
            //                type: 'post',
            //                url: '../../ashx/plc/ahPlcDtTemp.ashx?action=gpp',
            //                data: datas,
            //                dataType: 'text',
            //                success: function (msg) {
            //                    var url = '../../ashx/plc/ahPlcDtTemp.ashx?action=ppgz&vpp=' + msg.split(',')[0];
            //                    vfwqdh = msg.split(',')[1];
            //                    

            //                }
            //            });


            //        }
        });
    }
//    function Loadpd() {
//        $('#plclb').combobox({
//            width: 60,
//            required: true,
//            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=ppgz',
//            method: 'get',
//            valueField: 'dIntGZID',
//            textField: 'dVchGZQZ',
//            panelHeight: 'auto'
//        });
    //    }
    function LoadVariableType() {

        $('#iVariableType').combobox({
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=VT',
            width: 80,
            method: 'get',
            valueField: 'dVchVariableCode',
            textField: 'dVchVariableName',
            panelHeight: 'auto',
            
           
        });

        $('#iVariableType').combobox('setValue', '0');
    }
    function xuanzhong() {
        var data1 = {
            dfactory: $('#a1').val(),
            dplc: $('#a2').val(),
            daddress: $('#a3').val(),
            dcjdz: $('#a4').val(),
            dsjmax: $('#idSjMax').val(),
            dsjmin: $('#idSjMin').val(),
            dbdmax: $('#idBdMax').val(),
            dbdmin: $('#idBdMin').val(),
            dbFwqdh: dFwqdh
        };

        $.ajax({
            type: 'post',
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=dadd',
            data: data1,
            dataType: 'text',
            success: function (msg) {
                if (msg == "0") {
                    parent.$.messager.alert("操作提示", "保存成功", "info");

                    $('#dg').datagrid('reload');

                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.msg
                    });
                }
            }
        });
    }
    //检查text是否为空
    function checkNull() { 
        
    }

    $.extend($.fn.validatebox.defaults.rules, {
        idcard: {// 验证身份证
            validator: function (value) {
                return /^\d{15}(\d{2}[A-Za-z0-9])?$/i.test(value);
            },
            message: '身份证号码格式不正确'
        },
        minLength: {
            validator: function (value, param) {
                return value.length >= param[0];
            },
            message: '请输入至少（2）个字符.'
        },
        length: { validator: function (value, param) {
            var len = $.trim(value).length;
            return len >= param[0] && len <= param[1];
        },
            message: "输入内容长度必须介于{0}和{1}之间."
        },
        phone: {// 验证电话号码
            validator: function (value) {
                return /^((\d{2,3})|(\d{3}\-))?(0\d{2,3}|0\d{2,3}-)?[1-9]\d{6,7}(\-\d{1,4})?$/i.test(value);
            },
            message: '格式不正确,请使用下面格式:020-88888888'
        },
        mobile: {// 验证手机号码
            validator: function (value) {
                return /^(13|15|18)\d{9}$/i.test(value);
            },
            message: '手机号码格式不正确'
        },
        intOrFloat: {// 验证整数或小数
            validator: function (value) {
                return /^\d+(\.\d+)?$/i.test(value);
            },
            message: '请输入数字，并确保格式正确'
        },
        currency: {// 验证货币
            validator: function (value) {
                return /^\d+(\.\d+)?$/i.test(value);
            },
            message: '货币格式不正确'
        },
        qq: {// 验证QQ,从10000开始
            validator: function (value) {
                return /^[1-9]\d{4,9}$/i.test(value);
            },
            message: 'QQ号码格式不正确'
        },
        integer: {// 验证整数 可正负数
            validator: function (value) {
                //return /^[+]?[1-9]+\d*$/i.test(value);

                return /^([+]?[0-9])|([-]?[0-9])+\d*$/i.test(value);
            },
            message: '请输入整数'
        },
        age: {// 验证年龄
            validator: function (value) {
                return /^(?:[1-9][0-9]?|1[01][0-9]|120)$/i.test(value);
            },
            message: '年龄必须是0到120之间的整数'
        },

        chinese: {// 验证中文
            validator: function (value) {
                return /^[\Α-\￥]+$/i.test(value);
            },
            message: '请输入中文'
        },
        english: {// 验证英语
            validator: function (value) {
                return /^[A-Za-z]+$/i.test(value);
            },
            message: '请输入英文'
        },
        unnormal: {// 验证是否包含空格和非法字符
            validator: function (value) {
                return /.+/i.test(value);
            },
            message: '输入值不能为空和包含其他非法字符'
        },
        username: {// 验证用户名
            validator: function (value) {
                return /^[a-zA-Z][a-zA-Z0-9_]{5,15}$/i.test(value);
            },
            message: '用户名不合法（字母开头，允许6-16字节，允许字母数字下划线）'
        },
        faxno: {// 验证传真
            validator: function (value) {
                //            return /^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/i.test(value);
                return /^((\d{2,3})|(\d{3}\-))?(0\d{2,3}|0\d{2,3}-)?[1-9]\d{6,7}(\-\d{1,4})?$/i.test(value);
            },
            message: '传真号码不正确'
        },
        zip: {// 验证邮政编码
            validator: function (value) {
                return /^[1-9]\d{5}$/i.test(value);
            },
            message: '邮政编码格式不正确'
        },
        ip: {// 验证IP地址
            validator: function (value) {
                return /d+.d+.d+.d+/i.test(value);
            },
            message: 'IP地址格式不正确'
        },
        name: {// 验证姓名，可以是中文或英文
            validator: function (value) {
                return /^[\Α-\￥]+$/i.test(value) | /^\w+[\w\s]+\w+$/i.test(value);
            },
            message: '请输入姓名'
        },
        date: {// 验证姓名，可以是中文或英文
            validator: function (value) {
                //格式yyyy-MM-dd或yyyy-M-d
                return /^(?:(?!0000)[0-9]{4}([-]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-]?)0?2\2(?:29))$/i.test(value);
            },
            message: '清输入合适的日期格式'
        },
        msn: {
            validator: function (value) {
                return /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(value);
            },
            message: '请输入有效的msn账号(例：abc@hotnail(msn/live).com)'
        },
        same: {
            validator: function (value, param) {
                if ($("#" + param[0]).val() != "" && value != "") {
                    return $("#" + param[0]).val() == value;
                } else {
                    return true;
                }
            },
            message: '两次输入的密码不一致！'
        }
    });
</script>
