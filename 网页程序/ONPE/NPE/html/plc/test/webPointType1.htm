<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/color.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css">
    <style type="text/css">
        #fm
        {
            margin: 0;
            padding: 10px 30px;
        }
        .ftitle
        {
            font-size: 14px;
            font-weight: bold;
            color: #666;
            padding: 5px 0;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
        }
        .fitem
        {
            margin-bottom: 5px;
        }
        .fitem label
        {
            display: inline-block;
            width: 80px;
        }
    </style>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
</head>
<body>
<table id="dg" title="PLC系统信息"></table>
    <div id="dlg" class="easyui-dialog" style="width: 350px; height: 220px; padding: 10px 20px"
        closed="true" buttons="#dlg-buttons">
        <div class="ftitle">PLC系统信息</div>
            <form id="fm" method="post" novalidate>
            <div class="fitem">
                <label>
                    系统名称:</label>
                <input id="iXtName" name="nXtName" class="easyui-textbox" >
            </div>
            <div class="fitem">
                <label>
                   区域名称:</label>
                <input id="iArea" name="nArea" class="easyui-combobox" >
            </div>
            </form>
    </div>
    <div id="dlg-buttons">
        <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="Save()">Save</a>
        <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">
            Cancel</a>
    </div>
    <div id="tb" style="height: auto">
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true"
            onclick="Add()">添加</a>| 
         <a href="javascript:void(0)" class="easyui-linkbutton"
                data-options="iconCls:'icon-edit',plain:true" onclick="Edit()">编辑</a>|
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true"
            onclick="Del()">删除</a>|
        
    </div>
</body>
</html>

<script type="text/javascript">
    $(document).ready(function () {
        $('#dg').datagrid({
            url: '../../ashx/plc/ahplcXitong.ashx?action=grid',
            method: 'post',
            loadMsg: "正在努力加载数据，请稍后...",
            pagination: true, //分页控件
            remoteSort: true,
            pagePosition: 'bottom', //分页控件位置
            rownumbers: true,
            singleSelect: true,
            columns: [[
                { field: 'dIntNoteID', title: '系统ID', width: 60, align: 'left',hidden:true },
                { field: 'dVchPointType',title: '系统名称', width: 150, align: 'center' },
                { field: 'dVchRemark', title: '区域名称', width: 120, align: 'right' },
                { field: 'dIntSjNoteID', title: '区域ID', width: 120, align: 'right',hidden:true },
            ]],

            width: 1066,
            //            rowStyler: function (index, row) { if (index % 2 == 0) { return 'background-color:#ccccff;'; } },
            //striped: true, pagination: true, rownumbers: true, singleSelect: true, pageNumber: 1, pageSize: 8, pageList: [1, 2, 4, 8, 16, 32], showFooter: true,
            toolbar: '#tb'


        });
        var p = $('#dg').datagrid('getPager');
        $(p).pagination({
            pageSize: 10, //每页显示的记录条数，默认为10 
            pageList: [10, 20, 30], //可以设置每页记录条数的列表 
            beforePageText: '第', //页数文本框前显示的汉字 
            afterPageText: '页    共 {pages} 页',
            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        });
        $('#iArea').combobox({
            url: '../../ashx/plc/ahplcXitong.ashx?action=topcombobox',
            method: 'get',
            required: true,
            valueField: 'dIntAreaID',
            textField: 'dVchArea',
            panelHeight: 'auto'
        });



    });
    var url;
    function Add() {
        $('#dlg').dialog('open').dialog('setTitle', '添加窗口');
        $('#iXtName').textbox('setValue', '');
        $('#iArea').combobox('clear');
        url = "../../ashx/plc/ahplcXitong.ashx?action=PTAdd";
    }

    function Edit() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {

            $('#dlg').dialog('open').dialog('setTitle', '编辑窗口');
            $('#fm').form('load', row);
            $('#iXtName').textbox('setValue', row.dVchPointType);
            $('#iArea').combobox('setValue', row.dIntSjNoteID);
            url = "../../ashx/plc/ahplcXitong.ashx?action=PTEdit&vID=" + row.dIntNoteID;
        }
    }

    function Save() {
        $('#fm').form('submit', {
            url: url,
            onSubmit: function (param) {
                param.vXtName = $('#iXtName').textbox('getValue');
                param.vAreaID = $('#iArea').combobox('getValue');
                param.vAreaName = $('#iArea').combobox('getText');
                return $(this).form('validate');
            },
            success: function (result) {
                var result = eval('(' + result + ')');
                //		            var result = eval(result);                 
                //		            if (result.success) {
                if (result == 0) {
                    $('#dlg').dialog('close'); 	// close the dialog
                    $('#dg').datagrid('reload'); // reload the user data
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.msg
                    });
                }
            }
        });
    }

    function Del() {
        var row = $('#dg').datagrid('getSelected');

        if (row) {
            $.messager.confirm('Confirm', '你确定要删除这条记录吗?', function (r) {
                if (r) {
                    url = "../../ashx/plc/ahplcXitong.ashx?action=PTDel";
                    $.post(url, { vID: row.dIntNoteID }, function (result) {
                        if (result == 0) {
                            $('#dg').datagrid('reload'); // reload the user data
                        } else {
                            $.messager.show({	// show error message
                                title: 'Error',
                                msg: result.msg
                            });
                        }

                    });
                }
            });
        }
    }
</script>
