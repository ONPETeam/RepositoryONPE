<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PLC区域信息</title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/color.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css">
    <style type="text/css">
        #fm
        {
            margin: 0;
            padding: 10px 30px;
        }
        .ftitle
        {
            font-size: 14px;
            font-weight: bold;
            color: #666;
            padding: 5px 0;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
        }
        .fitem
        {
            margin-bottom: 5px;
        }
        .fitem label
        {
            display: inline-block;
            width: 80px;
        }
    </style>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
</head>
<body>
<table id="dg" title="PLC区域信息"></table>
    <div id="dlg" class="easyui-dialog" style="width: 350px; height: 220px; padding: 10px 20px"
        closed="true" buttons="#dlg-buttons">
        <div class="ftitle">PLC区域信息</div>
            <form id="fm" method="post" novalidate>
            <div class="fitem">
                <label>
                    区域名称:</label>
                <input id="iQyName" name="nQyName" class="easyui-textbox" >
            </div>
            </form>
    </div>
    <div id="dlg-buttons">
        <a href="#" class="easyui-linkbutton" iconcls="icon-ok" onclick="Save()">Save</a>
        <a href="#" class="easyui-linkbutton" iconcls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">
            Cancel</a>
    </div>
    <div id="tb" style="height: auto">
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true"
            onclick="Add()">添加</a>| 
         <a href="javascript:void(0)" class="easyui-linkbutton"
                data-options="iconCls:'icon-edit',plain:true" onclick="Edit()">编辑</a>|
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true"
            onclick="Del()">删除</a>|
        
    </div>
</body>
</html>

<script type="text/javascript">
    $(document).ready(function () {
        $('#dg').datagrid({
            url: '../../ashx/plc/ahplcXitong.ashx?action=AreaGrid',
            method: 'post',
            loadMsg: "正在努力加载数据，请稍后...",
            pagination: true, //分页控件
            remoteSort: true,
            pagePosition: 'bottom', //分页控件位置
            rownumbers: true,
            singleSelect: true,
            columns: [[
                { field: 'dIntAreaID', title: '区域ID', width: 60, align: 'left' },
                { field: 'dVchArea', title: '区域名称', width: 150, align: 'center' },
                { field: 'dIntSJAreaID', title: '上级区域ID', width: 120, align: 'right',hidden:true }
            ]],

            width: 1066,
            //            rowStyler: function (index, row) { if (index % 2 == 0) { return 'background-color:#ccccff;'; } },
            //striped: true, pagination: true, rownumbers: true, singleSelect: true, pageNumber: 1, pageSize: 8, pageList: [1, 2, 4, 8, 16, 32], showFooter: true,
            toolbar: '#tb'


        });
        var p = $('#dg').datagrid('getPager');
        $(p).pagination({
            pageSize: 10, //每页显示的记录条数，默认为10 
            pageList: [10, 20, 30], //可以设置每页记录条数的列表 
            beforePageText: '第', //页数文本框前显示的汉字 
            afterPageText: '页    共 {pages} 页',
            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        });
        $('#dg').datagrid('hideColumn', 'dIntPLCID')
        $('#dg').datagrid('hideColumn', 'dIntPLCPinPaiID')
        $('#dg').datagrid('hideColumn', 'dIntGongYiXitongID')

    });
    var url;
    function Add() {
        $('#dlg').dialog('open').dialog('setTitle', '添加窗口');
        $('#iQyName').textbox('setValue', '');
        url = "../../ashx/plc/ahplcXitong.ashx?action=AreaAdd";
    }

    function Edit() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $('#dlg').dialog('open').dialog('setTitle', '编辑窗口');
            $('#iQyName').textbox('setValue', row.dVchArea);
            url = "../../ashx/plc/ahplcXitong.ashx?action=AreaEdit&vID=" + row.dIntAreaID;
        }
    }

    function Save() {
        var vdata = {
            vQyName: $('#iQyName').textbox('getValue')
        }

        $.ajax({
            type:'post',
            url:url,
            data:vdata,
            dataType:"text",
            success: function (msg) {
                if (msg == "0") {
                    parent.$.messager.alert("操作提示", "保存成功", "info");
                    $('#dg').datagrid('reload');

                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: msg
                    });
                }
            }
        });
    }

    function Del() {
        var row = $('#dg').datagrid('getSelected');
        
        if (row) {
            $.messager.confirm('Confirm', '你确定要删除这条记录吗?', function (r) {
                if (r) {
                    url = "../../ashx/plc/ahplcXitong.ashx?action=AreaDel";
                    $.post(url, { vID: row.dIntAreaID }, function (result) {
                        if (result == 0) {
                            $('#dg').datagrid('reload'); // reload the user data
                        } else {
                            $.messager.show({	// show error message
                                title: 'Error',
                                msg: result.msg
                            });
                        }

                    });
                }
            });
        }
    }
</script>
