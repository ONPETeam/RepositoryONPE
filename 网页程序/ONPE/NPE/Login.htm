<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="Scripts/EasyUI/themes/color.css">
    <link rel="stylesheet" type="text/css" href="Scripts/EasyUI/demo/demo.css">
    <link rel="stylesheet" type="text/css" href="css/fitem.css">
    <script type="text/javascript" src="Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="Scripts/EasyUI/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="Scripts/Common/common.js"></script>
    <script src="Scripts/JSCookies.js" type="text/javascript"></script>
    
</head>
<body>
    <noscript>
        <div style="position: absolute; z-index: 100000; height: 2046px; top: 0px; left: 0px;
            width: 100%; background: white; text-align: center;">
            <h1>
                必须打开浏览器的javascript支持！！！</h1>
        </div>
    </noscript>
    
    <div style="background-image: none">
        <div style="position: absolute; top: 50%; width: 550px; height: 260px; left: 50%;">
            <div class="easyui-layout" style="position: relative; top: -50%; left: -50%; width: 100%;
                height: 100%;">
                <div data-options="region:'north',border:false" style="height: 30px;">
                </div>
                <div data-options="region:'west',border:false" style="width: 150px; text-align: right;
                    vertical-align: middle;">
                    <img style="height: 180px; width: 120px;" />
                </div>
                <div data-options="region:'center',border:false">
                    <form id="loginFrm" method="post">
                    <div class="ftitle">
                        用户登录
                    </div>
                    <div class="fitem">
                        <label style="text-align: right; width: 60px;">
                            账号：</label>
                        <input id="user_name" class="easyui-textbox" required="true" missingmessage="账号不能为空！"
                            style="width: 280px; height: 30px; font-size: large;" />
                    </div>
                    <div class="fitem">
                        <label style="text-align: right; width: 60px;">
                            密码：</label>
                        <input type="password" id="user_pwd" class="easyui-textbox validatebox" required="true"
                            missingmessage="密码不能为空！" style="width: 280px; height: 30px; font-size: large;" />
                    </div>
                    <!--<div class="fitem">
                        <label style="text-align: right; width: 60px;">
                            验证码：</label>
                        <input type="text" onclick="createCode();$('#verify_code').val('').focus();" readonly="readonly"
                            id="checkCode" class="unchanged" title="点击刷新验证码" style="width: 60px; height: 30px;
                            border-style: none;" />
                        <input id="verify_code" autocomplete="off" class="easyui-textbox" required="true"
                            missingmessage="请输入验证码！" style="width: 100px; height: 30px;" />
                    </div>-->
                    <div class="fitem">
                        <label style="text-align: right; width: 60px">
                            记住密码：
                        </label>
                        <input type="radio" name="remember_pwd" value="0" style="width: 15px" checked="checked" />不记住
                        <input type="radio" name="remember_pwd" value="1" style="width: 15px" />三小时
                        <input type="radio" name="remember_pwd" value="2" style="width: 15px" />一天
                        <input type="radio" name="remember_pwd" value="3" style="width: 15px" />永久
                    </div>
                    <div class="fitem">
                        <table style="border-style: none; width: 100%;">
                            <tr>
                                <td align="left">
                                    <span id="msg" style="color: Red"></span>
                                </td>
                                <td align="right">
                                    <a id="reg_user" href="javascript:void(0)">没有账号？</a> <span style="width: 80px"></span>
                                    <a id="forget_pwd" href="javascript:void(0)">忘记密码？</a>
                                </td>
                            </tr>
                        </table>
                    </div>
                    </form>
                </div>
                <div data-options="region:'south',border:false" style="text-align: right; padding: 5px 0 0;">
                    <a class="easyui-linkbutton" data-options="iconCls:'icon-ok'" href="javascript:void(0)"
                        id="login_user" onclick="loginUser();" style="width: 80px">登陆</a>
                    <!--<a class="easyui-linkbutton"
                            data-options="iconCls:'icon-cancel'" href="javascript:void(0)" onclick="closeAddWin()"
                            style="width: 80px">注册</a>-->
                </div>
            </div>
            
        </div>
    </div>
</body>
</html>
<script language="javascript" type="text/javascript">
    function checkInput() {
        //return true;
        if ($.trim($("#user_name").val()) == "") {
            $("#msg").text("账号不能为空！");
            $("#msg").stop(true, true).animate({ opacity: "show" }, 2000, function () {//.stop使动画达到末尾，否则连按回车一直显示隐藏
                $("#msg").animate({ opacity: "hide" }, 1000);
            });
            $('#user_name').textbox('setText', '').focus();
            return false;
        }
        if ($.trim($("#user_pwd").val()) == "") {
            $("#msg").text("密码不能为空！");
            $("#msg").stop(true, true).animate({ opacity: "show" }, 2000, function () {//.stop使动画达到末尾，否则连按回车一直显示隐藏
                $("#msg").animate({ opacity: "hide" }, 1000);
            });
            $('#user_pwd').textbox('setText', '').focus();
            return false;
        }
        $('#login_user').linkbutton('disable');
        return true;
    }
    function loginUser() {
        if (checkInput()) {
            if ($('loginFrm').form('validate')) {
                $("#loginFrm").submit();
            }
        }
    };

    $(document).ready(function () {

        $('#reg_user').tooltip({
            position: 'left',
            content: $('<div>请联系管理员！！！</div>'),
            showEvent: 'click',
            onShow: function () {
                var t = $(this);
                t.tooltip('tip').unbind().bind('mouseenter', function () {
                    t.tooltip('show');
                }).bind('mouseleave', function () {
                    t.tooltip('hide');
                });
            }

        });
        $('#forget_pwd').tooltip({
            position: 'right',
            content: $('<div>请联系管理员！！！</div>'),
            showEvent: 'click',
            onShow: function () {
                var t = $(this);
                t.tooltip('tip').unbind().bind('mouseenter', function () {
                    t.tooltip('show');
                }).bind('mouseleave', function () {
                    t.tooltip('hide');
                });
            }

        });

        var url = location.href;
        //登录
        $("#loginFrm").form({
            url: 'ashx/sso/ssoclientHandler.ashx',
            onSubmit: function (param) {
                param.action = "login";
                param.user_name = $('#user_name').textbox('getValue');
                param.user_pwd = $('#user_pwd').val();
                param.equip_type = 1;
                param.equip_sign = "PC端浏览器";
                param.way_type = 1;
                //param.remember_pwd2 = $('#input[name="remember_pwd"]:checked ').val();
                return checkInput();   //验证码是否正确
            },
            success: function (data) {
                var result = eval('(' + data + ')');  //字符串转json
                if (result.success == "true") {
                    if (url.indexOf("ReturnUrl=") != -1) {
                        window.location.href = decodeURIComponent(url.substring(url.indexOf("ReturnUrl=") + 10));
                    }
                    else {
                        window.location.href = "index.htm";
                    }
                }
                else {
                    $("#msg").text(result.msg);
                    $("#msg").stop(true, true).animate({ opacity: "show" }, 2000, function () {
                        $("#msg").animate({ opacity: "hide" }, 1000);
                    });
                    //                   $('#verify_code').textbox('setText', '').focus();
                    $('#login_user').linkbutton('enable');
                    //                    createCode();   //刷新验证码
                    //                    $('#verify_code').textbox('setText', '').focus();
                }
            }
        })

        //回车提交表单
        $("#loginFrm").find('input').on('keyup', function (event) {
            if (event.keyCode == '13') {
                //登录按钮如果处于禁用状态，那么回车也不提交表单
                if (!($('#login_user').linkbutton("options").disabled) && $("#loginFrm").form('validate')) {
                    $("#loginFrm").submit();
                }
            }
        })
        //createCode();  //创建验证码
    });
</script>
