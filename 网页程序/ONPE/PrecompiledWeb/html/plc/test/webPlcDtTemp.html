<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>plc动态添加</title>
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/themes/color.css">
    <link rel="stylesheet" type="text/css" href="../../Scripts/EasyUI/demo/demo.css">
    <style type="text/css">
		#fm{
			margin:0;
			padding:10px 30px;
		}
		.ftitle{
			font-size:14px;
			font-weight:bold;
			color:#666;
			padding:5px 0;
			margin-bottom:10px;
			border-bottom:1px solid #ccc;
		}
		.fitem{
			margin-bottom:5px;
		}
		.fitem label{
			display:inline-block;
			width:80px;
		}
		
	</style>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.min.js"></script>
    <script type="text/javascript" src="../../Scripts/EasyUI/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../../Scripts/Module/timer.js"></script>
</head>
<body>
		<div class="ftitle">动态点地址添加</div>
		<form id="fm" method="post" novalidate>
		     
             <div class="fitem">
				<label>厂别:</label>
				<input id="ifactory" class="easyui-combobox" name="nfactory" 
			    data-options="
				url:'../../ashx/plc/ahPlcDtTemp.ashx?action=factory',
				method:'get',
				valueField:'dVchFactoryCode',
				textField:'dVchFactoryName',
				panelHeight:'auto',
                onSelect: function(rec){
                            var url = '../../ashx/plc/ahPlcDtTemp.ashx?action=plc&cb='+ rec.dVchFactoryCode;
                            $('#iplc').combobox('reload', url);
                           }"
			">
                
			</div>
            <div class="fitem">
				<label>plc:</label>
				<input id="iplc" class="easyui-combobox" name="nplc" 
			    data-options="
				url:'../../ashx/plc/ahPlcDtTemp.ashx?action=plc',
				method:'get',
				valueField:'dVchPLCbianma',
				textField:'dVchRemark',
				panelHeight:'auto'

			">
			</div>
            <div class="fitem">
				<label>点地址:</label>
				<input id="iadress" name="naddress">
			</div>
	    <a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="save()">Save</a>
		<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="qingkong()">Cancel</a>
		</form>
	 
        <div class="ftitle"></div>
    <table id="dg" title="plc点地址数据值" ></table>


</body>
</html>
<script type="text/javascript">

    $(document).ready(function () {
        $('#dg').datagrid({
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=grid',
            method: 'post',
            loadMsg: "正在努力加载数据，请稍后...",
            pagination: true, //分页控件
            remoteSort: true,
            pagePosition: 'bottom', //分页控件位置
            rownumbers: true,
            singleSelect: true,
            columns: [[
                { field: 'dIntDataID', title: '数据ID', width: 60, align: 'center',hidden:true },
                { field: 'dVchFactoryCode', title: '厂别代号', width: 100, align: 'center', hidden: true },
                { field: 'dVchFactoryName', title: '厂别', width: 100, align: 'center' },
                { field: 'dVchPLCCode', title: 'PLC编码', width: 100, align: 'center', hidden: true },
                { field: 'dVchRemark', title: 'PLC', width: 300, align: 'center' },
                { field: 'dVchAdress', title: '地址', width: 100, align: 'center' },
                { field: 'dVchCjdz', title: '采集地址', width: 100, align: 'center', hidden: true },
                { field: 'dVchValue', title: '实时值', width: 150, align: 'center' },
                { field: 'dVchUnit', title: '单位', width: 100, align: 'center',hidden:true },
                { field: 'dIntDqBz', title: '读取标识', width: 400, align: 'center', hidden: true },

            ]],

         
           toolbar: [{
               text: '删除',
               iconCls: 'icon-cut',
               handler: function () { remove() }
            }]

        });
        var p = $('#dg').datagrid('getPager');
        $(p).pagination({
            pageSize: 10, //每页显示的记录条数，默认为10 
            pageList: [10, 20, 30], //可以设置每页记录条数的列表 
            beforePageText: '第', //页数文本框前显示的汉字 
            afterPageText: '页    共 {pages} 页',
            displayMsg: '当前显示 {from} - {to} 条记录   共 {total} 条记录'
        });  

        $('#sgyxt').combobox({
            url: '../../ashx/plc/plcgyxt.ashx',
            method: 'get',
            valueField: 'id',
            textField: 'text',
            panelHeight: 'auto'
        });

    });
   

    //添加、修改、删除
    var url;
    function newplc() {
        $('#dlg').dialog('open').dialog('setTitle', '新增PLC');
        //        $('#fm').form('clear');
        //        $("#iPLCID").val("");
        $("#iPLCName").val("");
        $("#iIPAdress").val("");
        //        $("#iPLCPinPaiID").val();
        //        $("#iGongYiXitongID").val();
        $("#idVchRemark").val("");
        $("#d1 ").combobox('select', 0);
        $("#d2").combobox('select', 0);

        url = '../../ashx/plc/plcmanagerOperator.ashx?type=add';
    }
    function editplc() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $('#dlg').dialog('open').dialog('setTitle', '编辑PLC');
            $('#fm').form('load', row);
            url = '../../ashx/plc/plcmanagerOperator.ashx?type=edit&ID=' + row.dIntPLCID;
            //            $("#iPLCID").val(row.dIntPLCID);
            $("#iPLCName").val(row.dVchPLCName);
            $("#iIPAdress").val(row.dVchIPAdress);
            //        $("#iPLCPinPaiID").val(row.dIntPLCPinPaiID);
            $("#iGongYiXitongID").val(row.dIntGongYiXitongID);
            $("#iRemark").val(row.dVchRemark);
            $("#d1 ").combobox('select', row.dIntPLCPinPaiID);
            $("#d2").combobox('select', row.dIntGongYiXitongID);
        }

    }


    function save() {
        $('#fm').form('submit', {
            url: '../../ashx/plc/ahPlcDtTemp.ashx?action=add',
            onSubmit: function () {
                return $(this).form('validate');
            },
            success: function (result) {
                var result = eval('(' + result + ')');
                //		            var result = eval(result);                 
                //		            if (result.success) {
                if (result == 0) {
                   
                    $('#dg').datagrid('reload'); // reload the user data
                } else {
                    $.messager.show({
                        title: 'Error',
                        msg: result.msg
                    });
                }
            }
        });
    }



    function qingkong()
    {
        $('#ifactory').combobox('clear');
        $('#iplc').combobox('clear');
        $('#iadress').val("");
    }
    function remove() {
        var row = $('#dg').datagrid('getSelected');
        if (row) {
            $.messager.confirm('Confirm', '你确定要删除这条记录吗?', function (r) {
                if (r) {
                    $.post('../../ashx/plc/ahPlcDtTemp.ashx?action=del&vID=' + row.dIntDataID, { cj: row.dVchCjdz }, function (result) {
                        if (result == 1) {
                            $('#dg').datagrid('reload'); // reload the user data
                        } else {
                            $.messager.show({	// show error message
                                title: 'Error',
                                msg: result.msg
                            });
                        }
                    }, 'json');
                }
            });
        }
    }

    function doSearch() {
        $('#dg').datagrid('load', {
            plcname: $('#splcname').val(),
            gyxt: $('#sgyxt').combobox('getValue')
        });
        
    }

    $('body').everyTime('5s', function () {
        $('#dg').datagrid('reload');
    });
</script>
